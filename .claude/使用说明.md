# Hooks 和 Skills 使用指南

## 📋 概述

本项目配置了两种自动化工具：
- **Skills（技能提示）**：根据你的需求自动提示相关开发技能
- **Hooks（文件追踪）**：自动记录代码变更，便于追踪和构建

## 🚀 快速开始

### 方式一：使用 npm 命令（推荐）

```bash
# 技能提示 - 输入你的需求，查看相关技能建议
echo '{"prompt":"create miniprogram page"}' | npm run skill

# 手动追踪单个文件变更
cat <<EOF | npm run track
{"tool_name":"Edit","tool_input":{"file_path":"/path/to/file.js"},"session_id":"my-session"}
EOF

# 启动文件变更监听（自动追踪）
npm run track:watch

# 安装 Git Hook（提交时自动追踪）
npm run track:setup-git
```

### 方式二：使用 Cursor/VSCode 任务

1. 按 `Cmd+Shift+P` (Mac) 或 `Ctrl+Shift+P` (Windows/Linux)
2. 输入 `Tasks: Run Task`
3. 选择以下任务之一：
   - 🔍 **启动文件变更监听** - 自动监听并追踪文件变更
   - 📝 **手动追踪当前文件** - 追踪当前打开的文件
   - 🎯 **技能提示检查** - 输入需求查看技能建议
   - ⚙️ **安装 Git Hook** - 设置提交时自动追踪

## 📖 详细说明

### 1. Skills（技能提示）

**作用**：根据你的需求关键词，自动匹配并提示相关的开发技能和规范。

**使用场景**：
- 开始新功能开发前，查看相关技能建议
- 不确定如何实现某个功能时，获取开发规范提示

**示例**：
```bash
# 查询小程序页面开发相关技能
echo '{"prompt":"create miniprogram page"}' | npm run skill

# 查询云函数开发相关技能
echo '{"prompt":"create cloud function"}' | npm run skill

# 查询饮食模块相关技能
echo '{"prompt":"add diet feature"}' | npm run skill
```

**输出示例**：
```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🎯 SKILL ACTIVATION CHECK
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📚 RECOMMENDED SKILLS:
  → wechat-miniprogram
  → wechat-cloud-function

ACTION: Use Skill tool BEFORE responding
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

### 2. Hooks（文件追踪）

**作用**：自动记录代码变更，生成追踪日志，便于：
- 了解哪些文件被修改
- 识别受影响的模块
- 自动生成构建命令

**追踪日志位置**：`.claude/tsc-cache/<session-id>/`

**文件说明**：
- `edited-files.log` - 记录所有被编辑的文件
- `affected-repos.txt` - 记录受影响的模块（miniprogram/cloudfunctions等）
- `commands.txt` - 记录相关的构建命令（如果有）

#### 方式 A：手动追踪

```bash
# 追踪单个文件
cat <<EOF | npm run track
{"tool_name":"Edit","tool_input":{"file_path":"/完整路径/to/file.js"},"session_id":"my-session"}
EOF
```

#### 方式 B：自动监听（推荐）

```bash
# 启动监听服务（后台运行）
npm run track:watch

# 或使用 Cursor 任务：🔍 启动文件变更监听
```

监听服务会：
- 自动监听 `miniprogram/` 和 `cloudfunctions/` 目录
- 检测到 `.js`, `.ts`, `.wxml`, `.wxss`, `.json` 文件变更时自动追踪
- 按 `Ctrl+C` 停止监听

#### 方式 C：Git Hook（最自动化）

```bash
# 安装 Git Hook
npm run track:setup-git

# 之后每次 git commit 时会自动追踪暂存的文件
git add .
git commit -m "feat: add new feature"
# ✅ 自动追踪所有变更的文件
```

## 🎯 自动化方案对比

| 方案 | 自动化程度 | 适用场景 | 设置难度 |
|------|-----------|---------|---------|
| **Git Hook** | ⭐⭐⭐⭐⭐ | 提交代码时自动追踪 | 简单（一次设置） |
| **文件监听** | ⭐⭐⭐⭐ | 开发过程中实时追踪 | 简单（需手动启动） |
| **手动追踪** | ⭐⭐ | 精确控制追踪时机 | 简单（每次手动调用） |
| **Skills 提示** | ⭐⭐⭐ | 开发前查看技能建议 | 简单（按需调用） |

## 🔧 高级配置

### 自定义追踪目录

编辑 `.claude/hooks/auto-track.sh`，修改监听目录：

```bash
# 默认监听
fswatch -o "$PROJECT_ROOT/miniprogram" "$PROJECT_ROOT/cloudfunctions"

# 添加其他目录
fswatch -o "$PROJECT_ROOT/miniprogram" "$PROJECT_ROOT/cloudfunctions" "$PROJECT_ROOT/utils"
```

### 自定义技能规则

编辑 `.claude/skills/skill-rules.json`，添加或修改技能规则。

## ❓ 常见问题

### Q: 为什么 Cursor 中 hooks 不会自动运行？

A: `.claude/settings.local.json` 中的 hooks 是为 **Claude Code (claude.ai/code)** 设计的，Cursor 不会自动读取。需要使用本文档中的方案。

### Q: 文件监听服务占用资源吗？

A: 监听服务占用资源很少，但如果你不需要实时追踪，建议使用 Git Hook 方案。

### Q: 如何查看追踪日志？

A: 日志保存在 `.claude/tsc-cache/<session-id>/` 目录下，可以直接查看。

### Q: 可以同时使用多种方案吗？

A: 可以，但建议只使用一种自动追踪方案（Git Hook 或文件监听），避免重复记录。

## 📝 更新日志

- 2025-12-12: 添加文件监听和 Git Hook 自动化方案
- 2025-12-12: 添加 Cursor/VSCode 任务配置
- 2025-12-12: 更新 tracker 脚本支持 miniprogram/cloudfunctions 目录


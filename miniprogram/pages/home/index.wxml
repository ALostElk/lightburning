<!--pages/home/index.wxml-->
<view class="container">
  <!-- æ¬¢è¿å¡ç‰‡ -->
  <view class="welcome-card">
    <view class="welcome-text">
      <text class="greeting">ä½ å¥½{{profile ? 'ï¼Œ' + (profile.name || 'ç”¨æˆ·') : ''}} ğŸ‘‹</text>
      <text class="date">{{profile ? profile.goal : 'å¼€å§‹ä½ çš„å¥åº·ä¹‹æ—…'}}</text>
    </view>
    <view class="profile-btn" bindtap="onEditProfile">
      <text>ä¸ªäººä¿¡æ¯</text>
    </view>
  </view>

  <!-- ä»Šæ—¥æ•°æ®å¡ç‰‡ -->
  <view class="data-card">
    <view class="card-title">ä»Šæ—¥æ•°æ®</view>
    
    <!-- çƒ­é‡è¿›åº¦ -->
    <view class="calorie-section">
      <view class="calorie-header">
        <text class="calorie-label">çƒ­é‡æ‘„å…¥</text>
        <text class="calorie-value">
          <text class="current">{{todayData.dietCalories}}</text>
          <text class="divider">/</text>
          <text class="target">{{todayData.targetCalories}}</text>
          <text class="unit">kcal</text>
        </text>
      </view>
      <view class="progress-bar">
        <view class="progress-fill" style="width: {{calorieProgress}}%"></view>
      </view>
      <view class="calorie-detail">
        <view class="detail-item">
          <text class="detail-label">è¿åŠ¨æ¶ˆè€—</text>
          <text class="detail-value">-{{todayData.exerciseCalories}}</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">å‡€æ‘„å…¥</text>
          <text class="detail-value {{todayData.netCalories > todayData.targetCalories ? 'over' : ''}}">{{todayData.netCalories}}</text>
        </view>
      </view>
    </view>

    <!-- è¥å…»ç´  -->
    <view class="macros-section">
      <view class="macro-item">
        <view class="macro-header">
          <text class="macro-label">è›‹ç™½è´¨</text>
          <text class="macro-value">{{macros.protein.current}}/{{macros.protein.target}}g</text>
        </view>
        <view class="macro-bar">
          <view class="macro-fill protein" style="width: {{macros.protein.target > 0 ? (macros.protein.current / macros.protein.target * 100) : 0}}%"></view>
        </view>
      </view>
      <view class="macro-item">
        <view class="macro-header">
          <text class="macro-label">ç¢³æ°´</text>
          <text class="macro-value">{{macros.carbs.current}}/{{macros.carbs.target}}g</text>
        </view>
        <view class="macro-bar">
          <view class="macro-fill carbs" style="width: {{macros.carbs.target > 0 ? (macros.carbs.current / macros.carbs.target * 100) : 0}}%"></view>
        </view>
      </view>
      <view class="macro-item">
        <view class="macro-header">
          <text class="macro-label">è„‚è‚ª</text>
          <text class="macro-value">{{macros.fat.current}}/{{macros.fat.target}}g</text>
        </view>
        <view class="macro-bar">
          <view class="macro-fill fat" style="width: {{macros.fat.target > 0 ? (macros.fat.current / macros.fat.target * 100) : 0}}%"></view>
        </view>
      </view>
    </view>
  </view>

  <!-- å¿«æ·æ“ä½œ -->
  <view class="quick-actions">
    <view 
      wx:for="{{quickActions}}" 
      wx:key="title"
      class="action-item"
      style="background: {{item.color}}15; border-color: {{item.color}}"
      data-url="{{item.url}}"
      bindtap="onQuickAction"
    >
      <text class="action-icon">{{item.icon}}</text>
      <text class="action-title">{{item.title}}</text>
    </view>
  </view>

  <!-- æ¨èé£Ÿè°± -->
  <view class="recommendations" wx:if="{{recommendations.length > 0}}">
    <view class="section-header">
      <text class="section-title">æ¨èé£Ÿè°±</text>
      <view class="section-more" bindtap="onRecipeRecommend">
        <text>æ›´å¤š</text>
        <text class="arrow">â€º</text>
      </view>
    </view>
    
    <view class="recipe-list">
      <view 
        wx:for="{{recommendations}}" 
        wx:key="id"
        class="recipe-card"
        data-id="{{item.id}}"
        bindtap="viewRecipe"
      >
        <image class="recipe-image" src="{{item.image || '/images/default-goods-image.png'}}" mode="aspectFill"></image>
        <view class="recipe-info">
          <text class="recipe-name">{{item.name}}</text>
          <text class="recipe-calories">{{item.calories}}kcal</text>
        </view>
      </view>
    </view>
  </view>

  <!-- AIå»ºè®®å…¥å£ -->
  <view class="ai-entry" bindtap="onAISuggestion">
    <view class="ai-icon">ğŸ¤–</view>
    <view class="ai-text">
      <text class="ai-title">AI å¥åº·å»ºè®®</text>
      <text class="ai-desc">è·å–ä¸ªæ€§åŒ–å¥åº·æŒ‡å¯¼</text>
    </view>
    <text class="ai-arrow">â€º</text>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-state" wx:if="{{loading}}">
    <text>åŠ è½½ä¸­...</text>
  </view>
</view>

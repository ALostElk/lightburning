<!-- pages/home/index.wxml -->
<view class="page-container">


  <!-- æ—¥æœŸå¯¼èˆª (å¯é€‰ï¼Œä¿æŒåœ¨è®¾è®¡ä¸­ä»¥å¤‡ç”¨) -->
  <view class="date-navigator">
      <view class="nav-arrow" bindtap="goToPrevDay">â€¹</view>
      <view class="date-display" bindtap="showCalendar">
        <text class="date-text">{{formattedDate}}</text>
      </view>
      <view class="nav-arrow" bindtap="goToNextDay">â€º</view>
  </view>

  <!-- 2. æ ¸å¿ƒåŒºï¼šèƒ½é‡çº¢ç»¿ç¯ Hero Card -->
  <view class="hero-section">
    <view class="hero-card" data-status="{{heroStatus}}">
      <!-- åŠ¨æ€å…‰æ™• -->
      <view class="hero-glow"></view>
      
      <view class="hero-content">
        <text class="hero-label">ä»Šæ—¥èƒ½é‡å¹³è¡¡</text>
        <view class="hero-value-group">
            <text class="hero-value">{{todayData.calorieBalance > 0 ? '+' : ''}}{{todayData.calorieBalance}}</text>
            <text class="hero-unit">kcal</text>
        </view>
        
        <!-- çŠ¶æ€èƒ¶å›Š -->
        <view class="hero-status-pill">
            <view class="status-dot"></view>
            <text class="status-text">{{heroStatusText}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 3. æ•°æ®åŒçƒ Stats Grid -->
  <view class="stats-grid">
    <!-- é¥®é£Ÿçƒ -->
    <view class="stat-card diet-card" bindtap="onViewNutritionDetail">
        <view class="mini-sphere diet-sphere">
            <view class="sphere-glass"></view>
            <!-- æ¶²ä½“é«˜åº¦æ ¹æ®ç™¾åˆ†æ¯”å˜åŒ– -->
            <view class="liquid" style="height: {{progressMetrics.dietProgress}}%">
                <view class="wave-layer wave-1"></view>
                <view class="wave-layer wave-2"></view>
                <view class="wave-layer wave-3"></view>
            </view>
        </view>
        <view class="stat-info">
            <text class="stat-label">é¥®é£Ÿæ‘„å…¥</text>
            <view>
                <text class="stat-num">{{todayData.dietCalories}}</text>
                <text class="stat-target">/ {{todayData.targetCalories}}</text>
            </view>
        </view>
    </view>

    <!-- è¿åŠ¨çƒ -->
    <view class="stat-card exercise-card" bindtap="onViewExerciseDetail">
        <view class="mini-sphere exercise-sphere">
            <view class="sphere-glass"></view>
            <view class="liquid" style="height: {{progressMetrics.exerciseProgress}}%">
                <view class="wave-layer wave-1"></view>
                <view class="wave-layer wave-2"></view>
                <view class="wave-layer wave-3"></view>
            </view>
        </view>
        <view class="stat-info">
            <text class="stat-label">è¿åŠ¨æ¶ˆè€—</text>
            <view>
                <text class="stat-num">{{todayData.exerciseCalories}}</text>
                <text class="stat-target">/ {{todayData.exerciseTargetCalories}}</text>
            </view>
        </view>
    </view>
  </view>

  <!-- 4. è¡ŒåŠ¨èƒ¶å›Š Actions -->
  <view class="actions-grid">
    <!-- ä¸»æ“ä½œï¼šé¥®é£Ÿè®°å½• -->
    <view class="action-card primary" bindtap="onQuickAction" data-url="/pages/diet/index/index">
        <view class="action-glow"></view>
        <view class="action-content">
            <text class="action-label">é¥®é£Ÿè®°å½•</text>
        </view>
    </view>

    <!-- è®°è¿åŠ¨ -->
    <view class="action-card" bindtap="onQuickAction" data-url="/pages/exercise/index/index">
        <view class="action-content">
            <text class="action-label">è¿åŠ¨è®°å½•</text>
        </view>
    </view>

    <!-- çœ‹è®¡åˆ’ -->
    <view class="action-card" bindtap="onQuickAction" data-url="/pages/plan/detail/index">
        <view class="action-content">
            <text class="action-label">æˆ‘çš„è®¡åˆ’</text>
        </view>
    </view>

    <!-- é—® AI -->
    <view class="action-card" bindtap="onAISuggestion">
        <view class="action-content">
            <text class="action-label">AIåˆ†æ</text>
        </view>
    </view>
  </view>

  <!-- 5. AI å»ºè®®æ¡ (æ‚¬æµ®) -->
  <view class="ai-floating-bar animate-fade-in" wx:if="{{aiInsight.message}}">
      <text class="ai-bar-icon">ğŸ’¡</text>
      <text class="ai-bar-text">{{aiInsight.message}}</text>
      <view class="ai-bar-close" catchtap="closeAISuggestion">
        <text class="close-icon">âœ•</text>
      </view>
  </view>

  <!-- ============ æ—¥å†é€‰æ‹©å™¨å¼¹çª— ============ -->
  <view class="calendar-modal {{showCalendarModal ? 'show' : ''}}" catchtap="hideCalendar">
    <view class="calendar-content" catchtap="stopPropagation">
      <view class="calendar-header">
        <view class="calendar-nav" bindtap="prevMonth">
          <text>â€¹</text>
        </view>
        <text class="calendar-title">{{calendarYear}}å¹´{{calendarMonth}}æœˆ</text>
        <view class="calendar-nav" bindtap="nextMonth">
          <text>â€º</text>
        </view>
      </view>

      <!-- æ˜ŸæœŸå¤´ -->
      <view class="calendar-weekdays">
        <text class="weekday">æ—¥</text>
        <text class="weekday">ä¸€</text>
        <text class="weekday">äºŒ</text>
        <text class="weekday">ä¸‰</text>
        <text class="weekday">å››</text>
        <text class="weekday">äº”</text>
        <text class="weekday">å…­</text>
      </view>

      <!-- æ—¥æœŸç½‘æ ¼ -->
      <view class="calendar-days">
        <block wx:for="{{calendarDays}}" wx:key="date">
          <view
            class="calendar-day {{item.isCurrentMonth ? '' : 'other-month'}} {{item.isToday ? 'today' : ''}} {{item.isSelected ? 'selected' : ''}} {{item.hasRecord ? 'has-record' : ''}} {{item.isFuture ? 'future' : ''}}"
            bindtap="{{item.isFuture ? '' : 'selectCalendarDay'}}"
            data-date="{{item.date}}"
          >
            <text class="day-number">{{item.day}}</text>
            <view class="record-dot" wx:if="{{item.hasRecord}}"></view>
          </view>
        </block>
      </view>

      <!-- å¿«æ·é€‰é¡¹ -->
      <view class="calendar-shortcuts">
        <view class="shortcut-btn" bindtap="selectToday">ä»Šå¤©</view>
        <view class="shortcut-btn" bindtap="selectYesterday">æ˜¨å¤©</view>
        <view class="shortcut-btn" bindtap="selectThisWeek">æœ¬å‘¨</view>
      </view>
    </view>
  </view>

</view>

<!-- pages/home/index.wxml -->


<view class="page">

  

<!-- é¡¶éƒ¨æ¸å˜å¤´éƒ¨ -->
<view class="header">
  <view class="header-top">
    <view class="avatar-placeholder">
      <text class="avatar-text">{{profile && profile.name ? profile.name[0] : 'è¾¾'}}</text>
    </view>
    <view class="header-info">
      <text class="hello">
        {{ profile && profile.name ? ('ä½ å¥½ï¼Œ' + profile.name) : 'ä½ å¥½ï¼Œå¥åº·è¾¾äºº' }} ğŸ‘‹
      </text>
      <text class="subtitle">
        {{ profile && profile.goal ? profile.goal : 'å¼€å§‹ä½ çš„è½»ç‡ƒè®¡åˆ’å§' }}
      </text>
    </view>
    <view class="profile-btn" bindtap="onEditProfile">
      <text>ä¸ªäººä¿¡æ¯</text>
    </view>
  </view>

  <view class="header-bottom">
    <text class="header-date">ä»Šå¤©</text>
    <text class="header-tip">åšæŒæ‰“å¡ï¼Œè®©æ¯ä¸€å¤©éƒ½æ›´è½»ç›ˆ</text>
  </view>
</view>

<!-- ä¸»ä½“å†…å®¹ -->
<scroll-view scroll-y="true" class="content">

  <!-- ä»Šæ—¥æ€»è§ˆå¡ç‰‡ -->
  <view class="card today-card">
    <view class="card-header">
      <text class="card-title">ä»Šæ—¥æ€»è§ˆ</text>
      <text class="card-subtitle">çƒ­é‡ä¸è¿åŠ¨ä¸€ç›®äº†ç„¶</text>
    </view>

    <view class="today-main">
      <!-- å·¦ä¾§åœ†ç¯ -->
      <view class="calorie-ring">
        <view class="ring-outer">
          <view class="ring-inner">
            <text class="ring-number">{{todayData.netCalories}}</text>
            <text class="ring-unit">å‡€æ‘„å…¥(kcal)</text>
          </view>
        </view>
        <text class="ring-tip">ç›®æ ‡ {{todayData.targetCalories}} kcal</text>
      </view>

      <!-- å³ä¾§æ•°æ® -->
      <view class="today-stats">
        <view class="stat-row">
          <view class="dot dot-intake"></view>
          <view class="stat-text">
            <text class="stat-label">å·²æ‘„å…¥</text>
            <text class="stat-value">{{todayData.dietCalories}} kcal</text>
          </view>
        </view>
        <view class="stat-row">
          <view class="dot dot-exercise"></view>
          <view class="stat-text">
            <text class="stat-label">è¿åŠ¨æ¶ˆè€—</text>
            <text class="stat-value">-{{todayData.exerciseCalories}} kcal</text>
          </view>
        </view>
        <view class="stat-row">
          <view class="dot dot-target"></view>
          <view class="stat-text">
            <text class="stat-label">å®Œæˆåº¦</text>
            <text class="stat-value">
              {{calorieProgress}}%
            </text>
          </view>
        </view>
      </view>
    </view>

    <!-- çƒ­é‡è¿›åº¦æ¡ -->
    <view class="card-section">
      <view class="section-row">
        <text class="section-label">ä»Šæ—¥çƒ­é‡è¿›åº¦</text>
        <text class="section-value">{{todayData.dietCalories}} / {{todayData.targetCalories}} kcal</text>
      </view>
      <view class="progress-bar">
        <view class="progress-fill" style="width: {{calorieProgress}}"></view>
      </view>
    </view>
  </view>

  <!-- è¥å…»ç´ å¡ç‰‡ -->
  <view class="card macros-card">
    <view class="card-header">
      <text class="card-title">è¥å…»åˆ†å¸ƒ</text>
      <text class="card-subtitle">è›‹ç™½è´¨ / ç¢³æ°´ / è„‚è‚ª</text>
    </view>

    <view class="macro-item">
      <view class="macro-row">
        <text class="macro-label">è›‹ç™½è´¨</text>
        <text class="macro-value">
          {{macros.protein.current}} / {{macros.protein.target}} g
        </text>
      </view>
      <view class="macro-bar">
        <view class="macro-fill protein"
              style="width: {{macros.protein.target > 0 ? (macros.protein.current / macros.protein.target * 100) : 0}}">
        </view>
      </view>
    </view>

    <view class="macro-item">
      <view class="macro-row">
        <text class="macro-label">ç¢³æ°´</text>
        <text class="macro-value">
          {{macros.carbs.current}} / {{macros.carbs.target}} g
        </text>
      </view>
      <view class="macro-bar">
        <view class="macro-fill carbs"
              style="width: {{macros.carbs.target > 0 ? (macros.carbs.current / macros.carbs.target * 100) : 0}}">
        </view>
      </view>
    </view>

    <view class="macro-item">
      <view class="macro-row">
        <text class="macro-label">è„‚è‚ª</text>
        <text class="macro-value">
          {{macros.fat.current}} / {{macros.fat.target}} g
        </text>
      </view>
      <view class="macro-bar">
        <view class="macro-fill fat"
              style="width: {{macros.fat.target > 0 ? (macros.fat.current / macros.fat.target * 100) : 0}}">
        </view>
      </view>
    </view>
  </view>

  <!-- å¿«æ·æ“ä½œ -->
<view class="card quick-card">
  <view class="card-header">
    <text class="card-title">å¿«æ·è®°å½•</text>
    <text class="card-subtitle">å¸¸ç”¨æ“ä½œä¸€é”®ç›´è¾¾</text>
  </view>

  <view class="quick-grid">
    <view
      wx:for="{{quickActions}}"
      wx:key="title"
      class="quick-item"
      style="background: {{item.color}}15; border-color: {{item.color}}"
      data-url="{{item.url}}"
      bindtap="onQuickAction"
    >
      <view class="quick-icon">{{item.icon}}</view>
      <text class="quick-title">{{item.title}}</text>
    </view>
  </view>
</view>

  <!-- æ¨èé£Ÿè°± -->
  <view class="card recommend-card" wx:if="{{recommendations.length > 0}}">
    <view class="card-header">
      <text class="card-title">ä»Šæ—¥æ¨èé£Ÿè°±</text>
      <view class="section-more" bindtap="onRecipeRecommend">
        <text>æ›´å¤š</text>
        <text class="arrow">â€º</text>
      </view>
    </view>

    <scroll-view scroll-x="true" class="recipe-scroll" show-scrollbar="false">
      <view class="recipe-list">
        <view wx:for="{{recommendations}}"
              wx:key="id"
              class="recipe-card"
              data-id="{{item.id}}"
              bindtap="viewRecipe">
          <image class="recipe-image"
                 src="{{item.image || '/images/default-goods-image.png'}}"
                 mode="aspectFill" />
          <view class="recipe-info">
            <text class="recipe-name">{{item.name}}</text>
            <text class="recipe-calories">{{item.calories}} kcal</text>
          </view>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- AI å»ºè®®å…¥å£ -->
<view class="ai-entry" bindtap="onAISuggestion">
  <view class="ai-left">
    <view class="ai-icon">ğŸ¤–</view>
    <view class="ai-text">
      <text class="ai-title">AI å¥åº·å»ºè®®</text>
      <text class="ai-desc">åŸºäºä»Šæ—¥æ•°æ®ç”Ÿæˆä¸ªæ€§åŒ–æ–¹æ¡ˆ</text>
    </view>
  </view>
  <text class="ai-arrow">â€º</text>
</view>


  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-mask" wx:if="{{loading}}">
    <view class="loading-box">
      <text class="loading-text">æ•°æ®åŠ è½½ä¸­...</text>
    </view>
  </view>

</scroll-view>
</view>

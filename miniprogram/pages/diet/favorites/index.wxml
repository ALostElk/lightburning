<!--
  æˆ‘çš„å¸¸ç”¨é¡µé¢ - diet-favorites/index
-->
<view class="page">
  <!-- èƒŒæ™¯è£…é¥° -->
  <view class="page-bg"></view>

  <!-- å¤´éƒ¨ -->
  <view class="header">
    <view class="back-btn" bindtap="goBack">
      <text>â†</text>
    </view>
    <text class="header-title">æˆ‘çš„å¸¸ç”¨</text>
    <view class="header-placeholder"></view>
  </view>

  <!-- Tab åˆ‡æ¢ -->
  <view class="tab-bar">
    <view class="tab-item {{activeTab === 'frequent' ? 'active' : ''}}"
          bindtap="switchTab" data-tab="frequent">
      <text class="tab-icon">ğŸ”¥</text>
      <text>å¸¸åƒé£Ÿç‰©</text>
    </view>
    <view class="tab-item {{activeTab === 'custom' ? 'active' : ''}}"
          bindtap="switchTab" data-tab="custom">
      <text class="tab-icon">ğŸ“</text>
      <text>è‡ªå®šä¹‰èœå“</text>
    </view>
  </view>

  <!-- é¤æ¬¡ç­›é€‰ï¼ˆä»…å¸¸åƒé£Ÿç‰©Tabæ˜¾ç¤ºï¼‰ -->
  <view wx:if="{{activeTab === 'frequent'}}" class="meal-filter-bar">
    <text class="filter-label">ç­›é€‰é¤æ¬¡:</text>
    <view class="filter-btn" bindtap="toggleMealFilter">
      <text>{{filterMealType ? mealTypeLabels[filterMealType] : 'å…¨éƒ¨'}}</text>
      <text class="filter-arrow">{{showMealFilter ? 'â–²' : 'â–¼'}}</text>
    </view>
  </view>

  <!-- é¤æ¬¡ç­›é€‰ä¸‹æ‹‰ -->
  <view wx:if="{{showMealFilter}}" class="meal-filter-dropdown">
    <view class="filter-option {{filterMealType === '' ? 'active' : ''}}"
          bindtap="selectMealFilter" data-type="">
      å…¨éƒ¨é¤æ¬¡
    </view>
    <view class="filter-option {{filterMealType === 'breakfast' ? 'active' : ''}}"
          bindtap="selectMealFilter" data-type="breakfast">
      ğŸŒ… æ—©é¤å¸¸ç”¨
    </view>
    <view class="filter-option {{filterMealType === 'lunch' ? 'active' : ''}}"
          bindtap="selectMealFilter" data-type="lunch">
      â˜€ï¸ åˆé¤å¸¸ç”¨
    </view>
    <view class="filter-option {{filterMealType === 'dinner' ? 'active' : ''}}"
          bindtap="selectMealFilter" data-type="dinner">
      ğŸŒ™ æ™šé¤å¸¸ç”¨
    </view>
    <view class="filter-option {{filterMealType === 'snack' ? 'active' : ''}}"
          bindtap="selectMealFilter" data-type="snack">
      â˜• åŠ é¤å¸¸ç”¨
    </view>
  </view>

  <!-- é¤æ¬¡æç¤º -->
  <view class="meal-hint">
    <text>æ·»åŠ åˆ°: </text>
    <text class="meal-name">{{mealTypeLabels[selectedMealType]}}</text>
  </view>

  <view class="content">
    <!-- åŠ è½½çŠ¶æ€ -->
    <view wx:if="{{isLoading}}" class="loading-box">
      <view class="loading-spinner"></view>
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>

    <!-- å¸¸åƒé£Ÿç‰©åˆ—è¡¨ -->
    <view wx:elif="{{activeTab === 'frequent'}}">
      <view wx:if="{{frequentFoods.length > 0}}" class="food-list">
        <view wx:for="{{frequentFoods}}" wx:key="name" class="food-card"
              bindtap="selectFood" data-food="{{item}}">
          <view class="food-emoji">{{item.emoji || 'ğŸ½ï¸'}}</view>
          <view class="food-info">
            <view class="food-name-row">
              <text class="food-name">{{item.name}}</text>
              <text class="use-count">ä½¿ç”¨ {{item.count}} æ¬¡</text>
            </view>
            <text class="food-meta">å¹³å‡ {{item.avgCalories}} kcal/æ¬¡</text>
          </view>
          <view class="food-action">
            <text class="action-icon">+</text>
          </view>
        </view>
      </view>
      <view wx:else class="empty-state">
        <view class="empty-icon">ğŸ“Š</view>
        <view class="empty-title">æš‚æ— å¸¸ç”¨é£Ÿç‰©</view>
        <view class="empty-desc">è®°å½•æ›´å¤šé¥®é£Ÿåï¼Œè¿™é‡Œä¼šæ˜¾ç¤ºä½ æœ€å¸¸åƒçš„é£Ÿç‰©</view>
      </view>
    </view>

    <!-- è‡ªå®šä¹‰èœå“åˆ—è¡¨ -->
    <view wx:elif="{{activeTab === 'custom'}}">
      <view wx:if="{{customDishes.length > 0}}" class="food-list">
        <view wx:for="{{customDishes}}" wx:key="_id" class="food-card"
              bindtap="selectCustomDish" data-dish="{{item}}">
          <view class="food-emoji">
            <image wx:if="{{item.imageUrl}}" src="{{item.imageUrl}}" class="dish-image" mode="aspectFill"/>
            <text wx:else>ğŸ³</text>
          </view>
          <view class="food-info">
            <view class="food-name-row">
              <text class="food-name">{{item.name}}</text>
              <text class="custom-badge">è‡ªå®šä¹‰</text>
            </view>
            <text class="food-meta">{{item.servingSize}} Â· {{item.calories}} kcal</text>
            <view class="food-macros">
              <text class="macro protein">è›‹ç™½ {{item.protein}}g</text>
              <text class="macro carbs">ç¢³æ°´ {{item.carbs}}g</text>
              <text class="macro fat">è„‚è‚ª {{item.fat}}g</text>
            </view>
          </view>
          <view class="food-actions">
            <view class="action-btn add" catchtap="selectCustomDish" data-dish="{{item}}">
              <text>+</text>
            </view>
            <view class="action-btn edit" catchtap="editDish" data-dish="{{item}}">
              <text>âœï¸</text>
            </view>
            <view class="action-btn delete" catchtap="deleteDish" data-id="{{item._id}}">
              <text>åˆ é™¤</text>
            </view>
          </view>
        </view>
      </view>
      <view wx:else class="empty-state">
        <view class="empty-icon">ğŸ“</view>
        <view class="empty-title">æš‚æ— è‡ªå®šä¹‰èœå“</view>
        <view class="empty-desc">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æ·»åŠ ä½ çš„ä¸“å±èœå“</view>
      </view>

      <!-- æ·»åŠ è‡ªå®šä¹‰èœå“æŒ‰é’® -->
      <view class="add-custom-btn" bindtap="goToAddCustom">
        <text class="btn-icon">+</text>
        <text>æ·»åŠ è‡ªå®šä¹‰èœå“</text>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æœç´¢å…¥å£ -->
  <view class="bottom-bar">
    <view class="search-entry" bindtap="goToSearch">
      <text class="search-icon">ğŸ”</text>
      <text>æœç´¢æ›´å¤šé£Ÿç‰©</text>
    </view>
  </view>
</view>

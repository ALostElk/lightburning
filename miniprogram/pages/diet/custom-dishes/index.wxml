<!--
  自定义菜品页面 - diet-custom/index
-->
<view class="page">
  <!-- 背景装饰 -->
  <view class="page-bg"></view>

  <!-- 头部 -->
  <view class="header">
    <view class="back-btn" bindtap="goBack">
      <text>←</text>
    </view>
    <text class="header-title">{{isEdit ? '编辑菜品' : '添加自定义菜品'}}</text>
    <view class="header-placeholder"></view>
  </view>

  <scroll-view class="content" scroll-y="true">
    <!-- 基本信息 -->
    <view class="form-card">
      <view class="card-title">基本信息</view>

      <view class="form-item">
        <text class="form-label">菜品名称 <text class="required">*</text></text>
        <input class="form-input"
               value="{{name}}"
               placeholder="输入菜品名称"
               bindinput="onNameInput" />
      </view>

      <view class="form-item">
        <text class="form-label">描述</text>
        <textarea class="form-textarea"
                  value="{{description}}"
                  placeholder="添加描述(选填)"
                  bindinput="onDescInput" />
      </view>

      <view class="form-item">
        <text class="form-label">份量单位</text>
        <input class="form-input"
               value="{{servingSize}}"
               placeholder="如: 1碗, 1份"
               bindinput="onServingSizeInput" />
      </view>

      <view class="form-item">
        <text class="form-label">每份克数</text>
        <view class="input-with-unit">
          <input class="form-input short"
                 type="digit"
                 value="{{gramsPerServing}}"
                 placeholder="100"
                 bindinput="onGramsInput" />
          <text class="unit">克</text>
        </view>
      </view>
    </view>

    <!-- 营养信息 -->
    <view class="form-card">
      <view class="card-title">营养信息(每份)</view>

      <view class="nutrition-grid">
        <view class="nutrition-item calories">
          <text class="nutrition-label">热量</text>
          <view class="nutrition-input-wrapper">
            <input class="nutrition-input"
                   type="digit"
                   value="{{calories}}"
                   placeholder="0"
                   data-field="calories"
                   bindinput="onNutritionInput" />
            <text class="nutrition-unit">千卡</text>
          </view>
        </view>

        <view class="nutrition-item protein">
          <text class="nutrition-label">蛋白质</text>
          <view class="nutrition-input-wrapper">
            <input class="nutrition-input"
                   type="digit"
                   value="{{protein}}"
                   placeholder="0"
                   data-field="protein"
                   bindinput="onNutritionInput" />
            <text class="nutrition-unit">克</text>
          </view>
        </view>

        <view class="nutrition-item carbs">
          <text class="nutrition-label">碳水</text>
          <view class="nutrition-input-wrapper">
            <input class="nutrition-input"
                   type="digit"
                   value="{{carbs}}"
                   placeholder="0"
                   data-field="carbs"
                   bindinput="onNutritionInput" />
            <text class="nutrition-unit">克</text>
          </view>
        </view>

        <view class="nutrition-item fat">
          <text class="nutrition-label">脂肪</text>
          <view class="nutrition-input-wrapper">
            <input class="nutrition-input"
                   type="digit"
                   value="{{fat}}"
                   placeholder="0"
                   data-field="fat"
                   bindinput="onNutritionInput" />
            <text class="nutrition-unit">克</text>
          </view>
        </view>
      </view>

      <view class="nutrition-tip">
        <text class="tip-icon">💡</text>
        <text class="tip-text">可参考食品包装或搜索类似食物</text>
      </view>
    </view>

    <!-- 图片上传 -->
    <view class="form-card">
      <view class="card-title">菜品图片(选填)</view>

      <view class="image-upload" bindtap="chooseImage">
        <image wx:if="{{imageUrl}}" src="{{imageUrl}}" class="preview-image" mode="aspectFill" />
        <view wx:else class="upload-placeholder">
          <text class="upload-icon">📷</text>
          <text class="upload-text">点击上传</text>
        </view>
      </view>
      <view wx:if="{{imageUrl}}" class="remove-image" bindtap="removeImage">
        <text>删除图片</text>
      </view>
    </view>

    <!-- 占位，防止被底部按钮遮挡 -->
    <view style="height: 40rpx;"></view>
  </scroll-view>

  <!-- 底部按钮 -->
  <view class="bottom-bar">
    <button class="save-btn" bindtap="save" disabled="{{isSaving || !name}}">
      <text wx:if="{{isSaving}}">保存中...</text>
      <text wx:else>{{isEdit ? '保存修改' : '添加菜品'}}</text>
    </button>
  </view>
</view>

<view class="page">

  <!-- 背景装饰 -->


  <!-- 悬浮返回按钮 -->
  <view class="nav-back-btn" bindtap="goBack" style="top: {{statusBarHeight}}px">
    <text class="back-arrow">‹</text>
  </view>

  <!-- 头部 -->
  <view class="header" style="margin-top: {{statusBarHeight}}px">
    <text class="header-title">{{isEdit ? '编辑菜品' : '添加自定义菜品'}}</text>
    <view class="header-placeholder"></view>
  </view>


  <scroll-view class="content" scroll-y="true">
    
    <view class="form-card animate-slide-up">
      <view class="card-header">
        <text class="card-title">基本信息</text>
        <text class="card-subtitle">Basic Info</text>
      </view>
      <view class="input-group">
        <view class="form-row">
          <text class="label">名称</text>
          <input class="glass-input" value="{{name}}" placeholder="例如：自制鸡胸肉沙拉" placeholder-class="ph-style" bindinput="onNameInput" />
        </view>
        
        <view class="form-row">
          <text class="label">份量</text>
          <input class="glass-input" value="{{servingSize}}" placeholder="例如：1 碗" placeholder-class="ph-style" bindinput="onServingSizeInput" />
        </view>
        <view class="form-row">
          <text class="label">克数</text>
          <view class="input-right">
            <input class="glass-input align-right" type="digit" value="{{gramsPerServing}}" placeholder="100" bindinput="onGramsInput" />
            <text class="suffix">g</text>
          </view>
        </view>
      </view>
    </view>
    <view class="form-card animate-slide-up" style="animation-delay: 0.1s;">
      <view class="card-header">
        <text class="card-title">营养成分</text>
        <text class="card-subtitle">每份含量</text>
      </view>
      <view class="macro-grid">
        <view class="macro-item highlight">
          <text class="macro-label">热量</text>
          <input class="macro-input" type="digit" value="{{calories}}" placeholder="0" data-field="calories" bindinput="onNutritionInput" />
          <text class="macro-unit">kcal</text>
        </view>
        
        <view class="macro-item protein">
          <text class="macro-label">蛋白质</text>
          <input class="macro-input" type="digit" value="{{protein}}" placeholder="0" data-field="protein" bindinput="onNutritionInput" />
          <text class="macro-unit">g</text>
        </view>
        <view class="macro-item carbs">
          <text class="macro-label">碳水</text>
          <input class="macro-input" type="digit" value="{{carbs}}" placeholder="0" data-field="carbs" bindinput="onNutritionInput" />
          <text class="macro-unit">g</text>
        </view>
        <view class="macro-item fat">
          <text class="macro-label">脂肪</text>
          <input class="macro-input" type="digit" value="{{fat}}" placeholder="0" data-field="fat" bindinput="onNutritionInput" />
          <text class="macro-unit">g</text>
        </view>
      </view>
    </view>
    <view class="upload-area compact" bindtap="chooseImage">
      <block wx:if="{{imageUrl}}">
        <image src="{{imageUrl}}" class="uploaded-img" mode="aspectFill" />
        <view class="re-upload-mask">
          <text>更换图片</text>
        </view>
      </block>
      <block wx:else>
        <view class="upload-placeholder row-layout">
          <view class="plus-icon small">+</view>
          <text>上传图片 (选填)</text>
        </view>
      </block>
    </view>

    <view style="height: 300rpx;"></view>
  </scroll-view>
  <view class="bottom-glass-bar">
    <view class="quick-add-bar">
      <text class="bar-label">添加到：</text>
      <view class="meal-pills-row">
        <block wx:for="{{mealOptions}}" wx:key="key">
          <view 
            class="meal-pill-mini {{addToMeal === item.key ? 'active' : ''}}" 
            bindtap="selectMealToAdd" 
            data-meal="{{item.key}}"
          >
            {{item.label}}
          </view>
        </block>
      </view>
    </view>

    <button class="save-pill-btn" bindtap="save" disabled="{{isSaving || !name}}">
      {{isSaving ? '保存中...' : (isEdit ? '保存修改' : '确认添加')}}
    </button>
  </view>
</view>

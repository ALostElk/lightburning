<!--
  食物搜索页面 - diet-search/index
  设计语言: Daylight Futurism (日光未来主义)
-->
<view class="page-container" style="padding-top: {{statusBarHeight + 44}}px">
  
  <view class="search-header" style="top: {{statusBarHeight}}px">
    <view class="nav-back-btn" bindtap="goBack">
      <text class="back-arrow">‹</text>
    </view>
    
    <view class="search-capsule">
      <view class="search-icon-css"></view>
      <input 
        class="search-input"
        value="{{keyword}}"
        placeholder="搜索食物名称..." 
        placeholder-class="input-placeholder"
        bindinput="onSearchInput"
        bindconfirm="onSearchConfirm"
        focus="{{true}}"
      />
      <view class="clear-btn" wx:if="{{keyword}}" bindtap="clearSearch">×</view>
    </view>
  </view>

  <scroll-view scroll-y class="search-body">
    
    <view class="result-list" wx:if="{{searchResults.length > 0}}">
      <block wx:for="{{searchResults}}" wx:key="id" wx:for-index="idx">
        <view class="food-card" bindtap="selectFood" data-item="{{item}}" data-index="{{idx}}">
          <view class="food-info">
            <text class="food-name">{{item.name}}</text>
            <view class="food-meta">
              <text class="cal-val">{{item.calories || 0}}</text>
              <text class="cal-unit">kcal/100g</text>
            </view>
          </view>
          
          <view class="add-btn-circle" catchtap="addFoodDirect" data-index="{{idx}}">
            <view class="plus-icon"></view>
          </view>
        </view>
      </block>
      
      <view class="list-end">- 没有更多结果了 -</view>
    </view>

    <view class="empty-state" wx:else>
      <view class="empty-header">
        <text class="empty-title">今天想吃点什么？</text>
      </view>

      <view class="meal-tabs">
        <block wx:for="{{mealTabs}}" wx:key="key">
          <view
            class="meal-tab {{currentMealTab === item.key ? 'active' : ''}}"
            bindtap="switchMealTab"
            data-key="{{item.key}}"
          >
            {{item.name}}
          </view>
        </block>
      </view>

      <view class="favorites-grid-wrapper">
        <view class="favorites-grid animate-fade-in">
          <block wx:for="{{favorites[currentMealTab]}}" wx:key="id">
            <view class="fav-card" bindtap="selectFood" data-item="{{item}}">
              <view class="fav-emoji">{{item.emoji}}</view>
              <view class="fav-info">
                <text class="fav-name">{{item.name}}</text>
                <text class="fav-cal">{{item.calories}} kcal</text>
              </view>
              <view class="fav-add">+</view>
            </view>
          </block>

          <view class="no-fav" wx:if="{{!favorites[currentMealTab] || favorites[currentMealTab].length === 0}}">
            <text>暂无常用记录</text>
          </view>
        </view>
      </view>
    </view>

  </scroll-view>

  <!-- ============ 食物编辑弹窗 ============ -->
  <view class="food-edit-modal {{showFoodEditModal ? 'show' : ''}}" catchtap="closeFoodEdit">
    <view class="food-edit-content" catchtap="stopPropagation">
      <view class="food-edit-header">
        <text class="food-edit-title">调整份量</text>
        <view class="food-edit-close" bindtap="closeFoodEdit">×</view>
      </view>

      <view class="food-edit-info">
        <view class="food-edit-name">{{editingFood.name}}</view>
      </view>

      <view class="slider-container">
        <view class="slider-header">
          <text>摄入量</text>
          <text class="slider-value">{{editingFood.grams || 100}}g</text>
        </view>
        <slider 
          class="amount-slider" 
          min="10" 
          max="500" 
          step="5" 
          value="{{editingFood.grams || 100}}" 
          activeColor="#059669" 
          backgroundColor="#E2E8F0"
          block-size="24"
          bindchanging="onSliderChange" 
          bindchange="onSliderChange"
        />
      </view>

      <view class="calories-preview">
        <view class="preview-item">
          <text class="p-label">热量</text>
          <text class="p-val">{{editingFood.calories || 0}}</text>
        </view>
        <view class="preview-item">
          <text class="p-label">蛋白质</text>
          <text class="p-val protein">{{editingFood.protein || 0}}g</text>
        </view>
        <view class="preview-item">
          <text class="p-label">碳水</text>
          <text class="p-val carbs">{{editingFood.carbs || 0}}g</text>
        </view>
        <view class="preview-item">
          <text class="p-label">脂肪</text>
          <text class="p-val fat">{{editingFood.fat || 0}}g</text>
        </view>
      </view>

      <view class="food-edit-actions">
        <view class="edit-btn-save" bindtap="confirmAddFood">确认添加</view>
      </view>
    </view>
  </view>
</view>

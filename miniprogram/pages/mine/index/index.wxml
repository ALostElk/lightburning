<!-- pages/mine/index/index.wxml -->
<view class="page">
  <!-- ç²˜æ€§å¤´éƒ¨ï¼ˆç”¨æˆ·ä¿¡æ¯åŒºï¼‰ -->
  <view class="sticky-header">
    <view class="header-content">
      <view class="user-info">
        <view class="avatar-wrapper" bindtap="chooseAvatar">
          <image class="user-avatar" src="{{userInfo.avatarUrl}}" mode="aspectFill"></image>
          <view class="status-dot"></view>
        </view>
        <view class="user-text">
          <text class="greeting">{{greeting}}</text>
          <text class="user-name">{{userInfo.nickName}}</text>
          <text class="nickname-edit-tip" bindtap="openNicknameModal">ç‚¹å‡»ç¼–è¾‘æ˜µç§°</text>
          <text class="user-basic">{{userInfo.height}}cm Â· {{userInfo.weight}}kg Â· {{userInfo.goal}}</text>
        </view>
        <button class="edit-btn" bindtap="goToEdit" size="mini">ç¼–è¾‘</button>
      </view>
    </view>
  </view>

  <!-- ä¸»å†…å®¹åŒº -->
  <view class="main-content">
    <!-- æ—¥æœŸåˆ‡æ¢å¯¼èˆªæ  -->
    <view class="date-nav-bar">
      <view class="date-nav-arrow">
        <text class="arrow-icon">â—€</text>
      </view>
      <view class="date-nav-center">
        <text class="date-nav-text">ä»Šæ—¥æ•°æ®</text>
      </view>
      <view class="date-nav-arrow">
        <text class="arrow-icon">â–¶</text>
      </view>
    </view>

    <!-- ä»ªè¡¨ç›˜å¡ç‰‡ -->
    <view class="dashboard-card">
      <view class="dashboard-content">
        <view class="calories-dashboard">
          <!-- ç¯å½¢å›¾å±•ç¤ºä»Šæ—¥æ ¸å¿ƒæ•°æ® -->
          <view class="donut-chart-wrapper">
            <view class="donut-chart">
              <view class="donut-ring" style="background: conic-gradient({{ringColor}} 0% {{ringDegrees}}deg, #E5E7EB {{ringDegrees}}deg 360deg);"></view>
              <view class="donut-center">
                <view class="donut-value-wrapper">
                  <text class="donut-value">{{todayIntake}}</text>
                  <text class="donut-unit">kcal</text>
                </view>
                <text class="donut-label">ä»Šæ—¥æ‘„å…¥</text>
              </view>
            </view>
          </view>

          <!-- èº«ä½“æŒ‡æ ‡è¯¦ç»†æ•°æ® -->
          <view class="calories-details">
            <view class="calorie-row">
              <view class="calorie-indicator bmi"></view>
              <text class="calorie-label">BMI</text>
              <view class="calorie-value-wrapper">
                <text class="calorie-value">{{formatNumber(userStats.BMI)}}</text>
              </view>
            </view>
            <view class="calorie-row">
              <view class="calorie-indicator bmi-kcal"></view>
              <text class="calorie-label">BMR</text>
              <view class="calorie-value-wrapper">
                <text class="calorie-value">{{formatNumber(userStats.bmr)}}</text>
                <text class="calorie-unit">kcal</text>
              </view>
            </view>
            <view class="calorie-row">
              <view class="calorie-indicator tdee"></view>
              <text class="calorie-label">TDEE</text>
              <view class="calorie-value-wrapper">
                <text class="calorie-value">{{formatNumber(userStats.tdee)}}</text>
                <text class="calorie-unit">kcal</text>
              </view>
            </view>
            <view class="calorie-row">
              <view class="calorie-indicator bmi-kcal"></view>
              <text class="calorie-label">ä»Šæ—¥æ‘„å…¥</text>
              <view class="calorie-value-wrapper">
                <text class="calorie-value">{{todayIntake}}</text>
                <text class="calorie-unit">kcal</text>
              </view>
            </view>
            <view class="calorie-row">
              <view class="calorie-indicator bmi-kcal"></view>
              <text class="calorie-label">ä»Šæ—¥æ¶ˆè€—</text>
              <view class="calorie-value-wrapper">
                <text class="calorie-value">{{todayConsume}}</text>
                <text class="calorie-unit">kcal</text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- åŠŸèƒ½æŒ‰é’®åŒºåŸŸ -->
    <view class="function-section">
      <view class="section-header">
        <text class="section-title">åŠŸèƒ½ä¸­å¿ƒ</text>
      </view>
      
      <view class="function-grid">
        <!-- åŠŸèƒ½é¡¹1ï¼šæˆ‘çš„è®¡åˆ’ -->
        <view class="grid-item" bindtap="goToPlan">
          <spotlight-card customClass="func-card plan" holo="{{true}}" customStyle="background: linear-gradient(135deg, #FFF7ED 0%, #FFEDD5 100%)">
            <view class="func-content">
              <view class="func-icon-wrapper plan">
                <text class="func-icon">ğŸ“‹</text>
              </view>
              <view class="func-info">
                <text class="func-title">æˆ‘çš„è®¡åˆ’</text>
                <text class="func-desc">æŸ¥çœ‹ç®¡ç†è®¡åˆ’</text>
              </view>
              <view class="func-arrow">â†’</view>
            </view>
          </spotlight-card>
        </view>

        <!-- åŠŸèƒ½é¡¹2ï¼šè‡ªå®šä¹‰èœå“ç®¡ç† -->
        <view class="grid-item" bindtap="goToCustomDishes">
          <spotlight-card customClass="func-card dish" holo="{{true}}" customStyle="background: linear-gradient(135deg, #F0FDF4 0%, #DCFCE7 100%)">
            <view class="func-content">
              <view class="func-icon-wrapper dish">
                <text class="func-icon">ğŸ½ï¸</text>
              </view>
              <view class="func-info">
                <text class="func-title">è‡ªå®šä¹‰èœå“</text>
                <text class="func-desc">ç®¡ç†æˆ‘çš„èœå“</text>
              </view>
              <view class="func-arrow">â†’</view>
            </view>
          </spotlight-card>
        </view>

        <!-- åŠŸèƒ½é¡¹3ï¼šæ”¶è—é£Ÿè°± -->
        <view class="grid-item" bindtap="goToFavorites">
          <spotlight-card customClass="func-card fav" holo="{{true}}" customStyle="background: linear-gradient(135deg, #F5F3FF 0%, #EDE9FE 100%)">
            <view class="func-content">
              <view class="func-icon-wrapper fav">
                <text class="func-icon">â­</text>
              </view>
              <view class="func-info">
                <text class="func-title">æ”¶è—é£Ÿè°±</text>
                <text class="func-desc">æˆ‘çš„æ”¶è—åˆ—è¡¨</text>
              </view>
              <view class="func-arrow">â†’</view>
            </view>
          </spotlight-card>
        </view>

        <!-- åŠŸèƒ½é¡¹4ï¼šæ•°æ®ç»Ÿè®¡ -->
        <view class="grid-item" bindtap="goToStats">
          <spotlight-card customClass="func-card stats" holo="{{true}}" customStyle="background: linear-gradient(135deg, #FFF1F2 0%, #FFE4E6 100%)">
            <view class="func-content">
              <view class="func-icon-wrapper stats">
                <text class="func-icon">ğŸ“Š</text>
              </view>
              <view class="func-info">
                <text class="func-title">æ•°æ®ç»Ÿè®¡</text>
                <text class="func-desc">æŸ¥çœ‹æ•°æ®è¶‹åŠ¿</text>
              </view>
              <view class="func-arrow">â†’</view>
            </view>
          </spotlight-card>
        </view>

        <!-- åŠŸèƒ½é¡¹5ï¼šä½¿ç”¨å¸®åŠ© (æ¨ªè·¨ä¸¤åˆ—) -->
        <view class="grid-item full-width" bindtap="goToHelp">
          <spotlight-card customClass="func-card help" holo="{{true}}" customStyle="background: linear-gradient(135deg, #F0F9FF 0%, #E0F2FE 100%)">
            <view class="func-content">
              <view class="func-icon-wrapper help">
                <text class="func-icon">â“</text>
              </view>
              <view class="func-info">
                <text class="func-title">ä½¿ç”¨å¸®åŠ©</text>
                <text class="func-desc">äº†è§£å¦‚ä½•ä½¿ç”¨æœ¬å°ç¨‹åº</text>
              </view>
              <view class="func-arrow">â†’</view>
            </view>
          </spotlight-card>
        </view>
      </view>
    </view>
  </view>

  <!-- æ˜µç§°ç¼–è¾‘å¼¹çª— -->
  <view class="modal-mask" wx:if="{{isNicknameModalShow}}" bindtap="cancelNicknameEdit"></view>
  <view class="modal-content" wx:if="{{isNicknameModalShow}}">
    <text class="modal-title">ä¿®æ”¹æ˜µç§°</text>
    <input 
      class="nickname-input" 
      placeholder="è¯·è¾“å…¥æ–°æ˜µç§°" 
      value="{{newNickname}}"
      bindinput="onNicknameInput"
    />
    <view class="modal-btns">
      <button class="modal-btn cancel" bindtap="cancelNicknameEdit">å–æ¶ˆ</button>
      <button class="modal-btn confirm" bindtap="confirmNicknameEdit">ç¡®è®¤</button>
    </view>
  </view>
</view>
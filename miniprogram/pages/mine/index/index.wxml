<!-- pages/mine/index/index.wxml -->
<view class="page">
  <!-- 极简头部 -->
  <view class="header-section">
    <view class="text-area">
      <text class="greeting-text">{{greeting}}，</text>
      <text class="name-text">{{userInfo.nickName}}</text>
      <view class="edit-pill" bindtap="goToEdit">
        <text>编辑资料</text>
      </view>
    </view>
    
    <view class="avatar-area" bindtap="chooseAvatar">
      <!-- 动态呼吸光环 -->
      <view class="avatar-glow" style="background: {{ringColor}}; box-shadow: 0 0 30rpx {{ringColor}};"></view>
      <image class="avatar-img" src="{{userInfo.avatarUrl}}" mode="aspectFill"></image>
    </view>
  </view>

  <!-- 身体与计划卡片 (极简玻璃态) -->
  <view class="glass-card stats-card">
    <!-- 上半部分：身体数据 -->
    <view class="stats-row">
      <view class="stat-item">
        <text class="stat-val">{{userInfo.height}}</text>
        <text class="stat-label">身高 cm</text>
      </view>
      <view class="vertical-line"></view>
      <view class="stat-item">
        <text class="stat-val">{{userInfo.weight}}</text>
        <text class="stat-label">体重 kg</text>
      </view>
      <view class="vertical-line"></view>
      <view class="stat-item">
        <text class="stat-val">{{userInfo.bmi}}</text>
        <view class="stat-label-row">
          <text class="stat-label">BMI</text>
          <text class="bmi-tag" wx:if="{{userInfo.bmiLabel}}">{{userInfo.bmiLabel}}</text>
        </view>
      </view>
    </view>

    <!-- 分割线 -->
    <view class="divider-dash"></view>

    <!-- 下半部分：计划目标 -->
    <view class="plan-row" bindtap="goToPlan">
      <view class="plan-info">
        <text class="plan-label">当前目标</text>
        <view class="plan-val-row">
          <text class="plan-val">{{userInfo.goal}}</text>
          <text class="plan-target" wx:if="{{userInfo.targetWeight}}">→ {{userInfo.targetWeight}} kg</text>
          <text class="plan-target" wx:else>未设置目标体重</text>
        </view>
      </view>
      <view class="plan-arrow">></view>
    </view>
  </view>

  <!-- 功能区 (无图标极简设计) -->
  <view class="minimal-grid">
    <!-- 我的计划 -->
    <view class="minimal-item" bindtap="goToPlan">
      <view class="item-content">
        <text class="item-title">我的计划</text>
        <text class="item-desc">管理目标</text>
      </view>
    </view>

    <!-- 自定义菜品 -->
    <view class="minimal-item" bindtap="goToCustomDishes">
      <view class="item-content">
        <text class="item-title">自定义菜品</text>
        <text class="item-desc">专属菜单</text>
      </view>
    </view>

    <!-- 收藏食谱 -->
    <view class="minimal-item" bindtap="goToFavorites">
      <view class="item-content">
        <text class="item-title">收藏食谱</text>
        <text class="item-desc">美味常备</text>
      </view>
    </view>

    <!-- 数据统计 -->
    <view class="minimal-item" bindtap="goToStats">
      <view class="item-content">
        <text class="item-title">数据统计</text>
        <text class="item-desc">趋势分析</text>
      </view>
    </view>
  </view>

   <!-- 昵称编辑弹窗 -->
  <view class="modal-mask" wx:if="{{isNicknameModalShow}}" bindtap="cancelNicknameEdit"></view>
  <view class="modal-content glass-modal" wx:if="{{isNicknameModalShow}}">
    <text class="modal-title">修改昵称</text>
    <input 
      class="nickname-input" 
      placeholder="请输入新昵称" 
      value="{{newNickname}}"
      bindinput="onNicknameInput"
    />
    <view class="modal-btns">
      <button class="modal-btn cancel" bindtap="cancelNicknameEdit">取消</button>
      <button class="modal-btn confirm" bindtap="confirmNicknameEdit">确认</button>
    </view>
  </view>
</view>
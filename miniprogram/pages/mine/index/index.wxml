<!-- pages/mine/index/index.wxml -->
<view class="page">
  <!-- é¡¶éƒ¨ç”¨æˆ·ä¿¡æ¯åŒºåŸŸï¼ˆæ¢å¤åŸæ ·å¼ï¼‰ -->
  <view class="user-info-card">
    <view class="avatar-wrap" bindtap="chooseAvatar">
      <image class="avatar" src="{{userInfo.avatarUrl}}" mode="aspectFill"></image>
    </view>
    <view class="user-base">
      <view class="user-name-wrap">
        <text class="user-name">{{userInfo.nickName}}</text>
        <button class="edit-btn" bindtap="goToEdit">ç¼–è¾‘</button>
      </view>
      <text class="nickname-edit-tip" bindtap="openNicknameModal">ç‚¹å‡»ç¼–è¾‘æ˜µç§°</text>
      <text class="user-basic">{{userInfo.height}}cm Â· {{userInfo.weight}}kg Â· {{userInfo.goal}}</text>
    </view>
  </view>

  <!-- ä»Šæ—¥æ•°æ®åŒºåŸŸï¼ˆæ¢å¤åŸæ ·å¼ï¼‰ -->
  <view class="stats-row">
    <view class="stats-item">
      <text class="stats-label">ä»Šæ—¥æ‘„å…¥</text>
      <text class="stats-value">{{todayIntake}}kcal</text>
    </view>
    <view class="stats-item">
      <text class="stats-label">ä»Šæ—¥æ¶ˆè€—</text>
      <text class="stats-value">{{todayConsume}}kcal</text>
    </view>
    <view class="stats-item">
      <text class="stats-label">è®°å½•æ¬¡æ•°</text>
      <text class="stats-value">{{recordCount}}</text>
    </view>
  </view>

  <!-- èº«ä½“æŒ‡æ ‡åŒºåŸŸï¼ˆæ¢å¤åŸæ ·å¼ï¼‰ -->
  <view class="body-stats-card">
    <text class="card-title">èº«ä½“æŒ‡æ ‡</text>
    <view class="body-stats-row">
      <view class="body-stats-item">
        <text class="stats-key">BMI</text>
        <text class="stats-val">{{formatNumber(userStats.bmi)}}</text>
      </view>
      <view class="body-stats-item">
        <text class="stats-key">BMR</text>
        <text class="stats-val">{{formatNumber(userStats.bmr)}}kcal</text>
      </view>
      <view class="body-stats-item">
        <text class="stats-key">TDEE</text>
        <text class="stats-val">{{formatNumber(userStats.tdee)}}kcal</text>
      </view>
    </view>
  </view>

  <!-- åŠŸèƒ½æŒ‰é’®åŒºåŸŸï¼ˆæ¢å¤åŸå¸ƒå±€ï¼‰ -->
  <view class="function-list">
    <view class="function-item" bindtap="goToPlan">
      <text class="func-icon">ğŸ“‹</text>
      <text class="func-text">æˆ‘çš„è®¡åˆ’</text>
      <text class="func-desc">æŸ¥çœ‹ç®¡ç†è®¡åˆ’</text>
      <text class="func-arrow">â†’</text>
    </view>
    <view class="function-item" bindtap="goToCustomDishes">
      <text class="func-icon">ğŸ½ï¸</text>
      <text class="func-text">è‡ªå®šä¹‰èœå“ç®¡ç†</text>
      <text class="func-desc">æˆ‘çš„èœå“</text>
      <text class="func-arrow">â†’</text>
    </view>
    <view class="function-item" bindtap="goToFavorites">
      <text class="func-icon">â­</text>
      <text class="func-text">æ”¶è—é£Ÿè°±</text>
      <text class="func-desc">æˆ‘çš„æ”¶è—</text>
      <text class="func-arrow">â†’</text>
    </view>
    <view class="function-item" bindtap="goToStats">
      <text class="func-icon">ğŸ“Š</text>
      <text class="func-text">æ•°æ®ç»Ÿè®¡</text>
      <text class="func-desc">æŸ¥çœ‹æ•°æ®è¶‹åŠ¿</text>
      <text class="func-arrow">â†’</text>
    </view>
    <view class="function-item" bindtap="goToHelp">
      <text class="func-icon">â“</text>
      <text class="func-text">ä½¿ç”¨å¸®åŠ©</text>
      <text class="func-desc">äº†è§£å¦‚ä½•ä½¿ç”¨</text>
      <text class="func-arrow">â†’</text>
    </view>
  </view>

  <!-- æ˜µç§°ç¼–è¾‘å¼¹çª— -->
  <view class="modal-mask" wx:if="{{isNicknameModalShow}}" bindtap="cancelNicknameEdit"></view>
  <view class="modal-content" wx:if="{{isNicknameModalShow}}">
    <text class="modal-title">ä¿®æ”¹æ˜µç§°</text>
    <input 
      class="nickname-input" 
      placeholder="è¯·è¾“å…¥æ–°æ˜µç§°" 
      value="{{newNickname}}"
      bindinput="onNicknameInput"
    />
    <view class="modal-btns">
      <button class="modal-btn cancel" bindtap="cancelNicknameEdit">å–æ¶ˆ</button>
      <button class="modal-btn confirm" bindtap="confirmNicknameEdit">ç¡®è®¤</button>
    </view>
  </view>
</view>
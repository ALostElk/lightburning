<!--pages/ai-suggestion/index.wxml-->
<view class="page-container">
  
  <!-- 极简头部: 纯文字排版 -->
  <view class="header-section">
    <text class="page-title">AI 智能分析</text>
    <text class="page-desc">基于您最近 {{weeklyStats.days}} 天的饮食记录</text>
  </view>

  <!-- 加载状态 -->
  <view wx:if="{{loading}}" class="loading-wrapper">
    <view class="loading-spinner"></view>
    <text class="loading-text">正在生成分析报告...</text>
  </view>

  <block wx:else>
    
    <!-- 智能建议 (无图标，色条指示) -->
    <view class="section-container">
      <view class="section-header">
        <text class="section-title">核心建议</text>
      </view>
      
      <view class="suggestions-list">
        <block wx:for="{{suggestions}}" wx:key="index">
          <view class="glass-card suggestion-item">
            <!-- 顶部极简指示条 (Organic Pill) -->
            <view class="note-indicator {{item.severity}}"></view>
            
            <view class="note-content">
               <text class="suggestion-title">{{item.title}}</text>
               <text class="suggestion-body">{{item.message}}</text>
            </view>
          </view>
        </block>
      </view>
    </view>

    <!-- 营养数据 (极简仪表盘) -->
    <view class="section-container">
      <view class="section-header">
        <text class="section-title">营养摄入概览</text>
      </view>

      <view class="glass-card dashboard-card">
        <!-- 核心数据行 -->
        <view class="data-row">
           <view class="data-col">
             <text class="label">蛋白质</text>
             <text class="value">{{weeklyStats.avg.protein}} <text class="unit">g</text></text>
             <view class="status-dot {{nutritionGap.proteinDeficit > 0 ? 'warn' : 'good'}}"></view>
           </view>
           <view class="divider"></view>
           <view class="data-col">
             <text class="label">碳水</text>
             <text class="value">{{weeklyStats.avg.carbs}} <text class="unit">g</text></text>
             <view class="status-dot {{nutritionGap.carbsExcess > 0 ? 'warn' : 'good'}}"></view>
           </view>
           <view class="divider"></view>
           <view class="data-col">
             <text class="label">脂肪</text>
             <text class="value">{{weeklyStats.avg.fat}} <text class="unit">g</text></text>
             <view class="status-dot {{nutritionGap.fatExcess > 0 ? 'warn' : 'good'}}"></view>
           </view>
        </view>
        
        <!-- 热量进度 -->
        <view class="progress-section">
           <view class="progress-info">
             <text class="label">热量摄入</text>
             <text class="value-small">{{weeklyStats.avg.calories}} / {{weeklyStats.goals.calories}} kcal</text>
           </view>
           <view class="progress-bar-bg">
             <view class="progress-bar-fill" style="width: {{weeklyStats.completion.calories}}%"></view>
           </view>
        </view>
      </view>
    </view>

    <!-- 推荐食谱 (无图标) -->
    <view class="section-container">
      <view class="section-header row-between">
         <text class="section-title">推荐食谱</text>
         <text class="link-text" bindtap="onRefresh">换一批</text>
      </view>

      <scroll-view scroll-x class="recipes-scroll" enable-flex>
        <view 
          wx:for="{{recommendedRecipes}}" 
          wx:key="id" 
          class="glass-card recipe-card"
          bindtap="onRecipeClick"
          data-id="{{item.id}}"
        >
          <image class="recipe-img" src="{{item.image}}" mode="aspectFill" />
          <view class="recipe-content">
             <text class="recipe-name">{{item.name}}</text>
             <view class="recipe-meta">
               <text class="meta-text">{{item.calories}} kcal</text>
               <text class="meta-dot">·</text>
               <text class="meta-text">蛋白质 {{item.protein}}g</text>
             </view>
          </view>
        </view>
      </scroll-view>
    </view>

  </block>
</view>

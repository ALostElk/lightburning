<!--pages/plan/detail/index.wxml-->
<view class="page-container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-container">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- ä¸»è¦å†…å®¹ -->
  <view wx:elif="{{plan}}" class="content">
    <!-- ========== è®¡åˆ’å¤´éƒ¨å¡ç‰‡ (Active Gradient) ========== -->
    <view class="card card-header">
      <view class="header-top">
        <text class="plan-title">{{plan.name || 'æˆ‘çš„å¥åº·è®¡åˆ’'}}</text>
        <view class="status-badge {{plan.status}}">
          <text>{{plan.status === 'active' ? 'è¿›è¡Œä¸­' : plan.status === 'completed' ? 'å·²å®Œæˆ' : 'å·²æš‚åœ'}}</text>
        </view>
      </view>
      
      <!-- è®¡åˆ’ç®€è¦ä¿¡æ¯ -->
      <view class="plan-meta">
        <view class="meta-item">
          <text class="meta-icon">ğŸ“…</text>
          <text class="meta-text">{{plan.totalDays}}å¤©è®¡åˆ’</text>
        </view>
        <view class="meta-item">
          <text class="meta-icon">ğŸ¯</text>
          <text class="meta-text">ç›®æ ‡{{plan.targetWeightChange > 0 ? '+' : ''}}{{plan.targetWeightChange}}kg</text>
        </view>
        <view class="meta-item">
          <text class="meta-icon">ğŸ”¥</text>
          <text class="meta-text">æ¯æ—¥{{Math.abs(plan.dailyDeficit)}}kcal</text>
        </view>
      </view>

      <!-- è¿›åº¦æ¡éƒ¨åˆ† -->
      <view class="progress-section">
        <view class="progress-info">
          <text class="progress-label">è®¡åˆ’è¿›åº¦</text>
          <text class="progress-text">{{daysElapsed}}/{{plan.totalDays}}å¤©</text>
        </view>
        <view class="progress-bar">
          <view class="progress-fill" style="width: {{progress}}%"></view>
        </view>
        <view class="progress-days">
          <text>å·²å®Œæˆ {{daysElapsed}} å¤©</text>
          <text>å‰©ä½™ {{daysRemaining}} å¤©</text>
        </view>
      </view>
    </view>

    <!-- ========== æ—¶é—´å®‰æ’å¡ç‰‡ ========== -->
    <view class="card glass-card">
      <view class="card-title">ğŸ“† æ—¶é—´å®‰æ’</view>
      <view class="info-row">
        <text class="info-label">å¼€å§‹æ—¥æœŸ</text>
        <text class="info-value">{{plan.startDate}}</text>
      </view>
      <view class="info-row">
        <text class="info-label">ç»“æŸæ—¥æœŸ</text>
        <text class="info-value">{{plan.endDate}}</text>
      </view>
    </view>

    <!-- ========== ç›®æ ‡è®¾å®šå¡ç‰‡ ========== -->
    <view class="card glass-card">
      <view class="card-title">ğŸ¯ ç›®æ ‡è®¾å®š</view>
      <view class="info-row">
        <text class="info-label">ç›®æ ‡ä½“é‡å˜åŒ–</text>
        <text class="info-value highlight">{{plan.targetWeightChange > 0 ? '+' : ''}}{{plan.targetWeightChange}}kg</text>
      </view>
      <view class="info-row">
        <text class="info-label">æ¯å‘¨é¢„æœŸå˜åŒ–</text>
        <text class="info-value">{{plan.weeklyChange}}kg/å‘¨</text>
      </view>
      <view class="info-row">
        <text class="info-label">æ¯æ—¥çƒ­é‡ç›®æ ‡</text>
        <text class="info-value">{{plan.dailyCalorieGoal}}kcal</text>
      </view>
      <view class="info-row">
        <text class="info-label">æ¯æ—¥çƒ­é‡å·®</text>
        <text class="info-value">{{plan.dailyDeficit}}kcal</text>
      </view>
    </view>

    <!-- ========== å¥åº·è¯„ä¼°å¡ç‰‡ ========== -->
    <view class="card glass-card" wx:if="{{plan.planHealth}}">
      <view class="card-title">ğŸ’ª å¥åº·è¯„ä¼°</view>
      <view class="health-card {{plan.planHealth.isHealthy ? 'healthy' : 'warning'}}">
        <view class="health-status">
          <text class="health-icon">{{plan.planHealth.isHealthy ? 'âœ“' : 'âš ï¸'}}</text>
          <text class="health-text">{{plan.planHealth.isHealthy ? 'è®¡åˆ’åˆç†å¥åº·' : 'å»ºè®®è°ƒæ•´è®¡åˆ’'}}</text>
        </view>
        <text class="health-desc">{{plan.planHealth.message}}</text>
      </view>
    </view>

    <!-- ========== å¥åº·å»ºè®®å¡ç‰‡ ========== -->
    <view class="card glass-card" wx:if="{{plan.suggestions && plan.suggestions.length > 0}}">
      <view class="card-title">ğŸ’¡ å¥åº·å»ºè®®</view>
      <view class="suggestions">
        <view wx:for="{{plan.suggestions}}" wx:key="index" class="suggestion-item">
          <text class="suggestion-text">â€¢ {{item}}</text>
        </view>
      </view>
    </view>

    <!-- ========== æ“ä½œæŒ‰é’® ========== -->
    <view class="action-buttons" wx:if="{{plan.status === 'active'}}">
      <view class="action-btn secondary-btn" bindtap="editPlan">
        <text>è°ƒæ•´è®¡åˆ’</text>
      </view>
      <view class="action-btn primary-btn" bindtap="completePlan">
        <text>å®Œæˆè®¡åˆ’</text>
      </view>
    </view>
  </view>
</view>
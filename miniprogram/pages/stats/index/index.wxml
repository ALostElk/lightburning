<!-- pages/stats/index.wxml -->
<view class="page">
  
  <!-- 1. 顶部时间切换 (悬浮胶囊，无背景卡片) -->
  <view class="header-actions">
    <view class="range-tabs">
      <view class="range-tab {{rangeDays === 7 ? 'active' : ''}}" data-days="7" bindtap="onRangeChange">近7天</view>
      <view class="range-tab {{rangeDays === 30 ? 'active' : ''}}" data-days="30" bindtap="onRangeChange">近30天</view>
      <view class="range-tab {{rangeDays === 90 ? 'active' : ''}}" data-days="90" bindtap="onRangeChange">近90天</view>
    </view>
    <view class="range-text">{{rangeText}}</view>
  </view>

  <!-- 2. 核心数据 (大字号，去线框) -->
  <view class="section-title">总体概览</view>
  <view class="glass-card big-stat-card">
    <view class="stat-row-main">
       <view class="stat-block">
         <text class="stat-label">平均摄入</text>
         <text class="stat-val big">{{avgCaloriesIn}}<text class="stat-unit">kcal</text></text>
       </view>
       <view class="vertical-divider"></view>
       <view class="stat-block">
         <text class="stat-label">总摄入</text>
         <text class="stat-val">{{totalCaloriesIn}}<text class="stat-unit">kcal</text></text>
       </view>
    </view>
    
    <view class="stat-row-sub">
       <view class="sub-pill">蛋白 {{totalProtein}}g</view>
       <view class="sub-pill">碳水 {{totalCarbs}}g</view>
       <view class="sub-pill">脂肪 {{totalFat}}g</view>
    </view>
  </view>

  <!-- 3. 体重目标 (极简进度) -->
  <view class="glass-card minimal-card">
    <view class="card-header-min">
      <text class="min-title">目标体重</text>
      <text class="min-sub">{{weightGoalText}}</text>
    </view>
    <view class="progress-track">
      <view class="progress-fill fill-orange" style="width: {{weightProgressPercent}}%;"></view>
    </view>
    <view class="progress-meta">
       <text>当前 {{currentWeight || '--'}}</text>
       <text>目标 {{targetWeight || '--'}}</text>
    </view>
  </view>

  <!-- 4. 计划完成 (极简进度) -->
  <view class="glass-card minimal-card">
    <view class="card-header-min">
      <text class="min-title">计划达标度</text>
      <text class="min-sub">{{planProgressPercent}}%</text>
    </view>
    <view class="progress-track">
      <view class="progress-fill fill-green" style="width: {{planProgressPercent}}%;"></view>
    </view>
    <view class="progress-meta">
       <text>{{planSummaryText}}</text>
    </view>
  </view>

  <!-- 5. 运动与营养 (双列布局) -->
  <view class="dual-grid">
    <!-- 运动 -->
    <view class="glass-card small-card">
       <view class="small-header">运动时长</view>
       <view class="small-val">{{exerciseMinutesTotal}} <text class="unit">min</text></view>
       <view class="small-desc">{{exerciseAvgMinutes}} min/练</view>
    </view>

    <!-- 营养结构 -->
    <view class="glass-card small-card">
       <view class="small-header">三大营养</view>
       <view class="macro-mini-row">
         <view class="macro-dot carbs"></view><text>碳 {{macroPercentCarb}}%</text>
       </view>
       <view class="macro-mini-row">
         <view class="macro-dot protein"></view><text>蛋 {{macroPercentProtein}}%</text>
       </view>
       <view class="macro-mini-row">
         <view class="macro-dot fat"></view><text>脂 {{macroPercentFat}}%</text>
       </view>
    </view>
  </view>

  <!-- 6. 每日记录 (列表模式) -->
  <view class="section-container">
    <view class="section-title">每日记录 · {{recordDays}}天</view>
    
    <block wx:if="{{dailyList.length}}">
      <view class="daily-list">
        <view class="daily-row" wx:for="{{dailyList}}" wx:key="date">
           <view class="daily-date-col">
             <view class="date-big">{{item.date}}</view>
           </view>
           <view class="daily-data-col">
             <text class="d-cal">{{item.calories}}</text>
             <text class="d-unit">kcal</text>
           </view>
        </view>
      </view>
    </block>
    <block wx:else>
      <view class="empty-state">暂无记录</view>
    </block>
  </view>

  <!-- 底部周报入口 -->
  <view class="footer-action" bindtap="goWeeklyReport">
    查看详细周报 ->
  </view>

</view>

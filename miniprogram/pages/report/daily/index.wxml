<!--pages/report/daily/index.wxml-->
<view class="container">
  <view class="header">
    <text class="title">æ¯æ—¥æŠ¥å‘Š</text>
    <view class="date-selector">
      <view class="date-btn" data-delta="{{-1}}" bindtap="changeDate">
        <text>â†</text>
      </view>
      <text class="date">{{date}}</text>
      <view class="date-btn" data-delta="{{1}}" bindtap="changeDate">
        <text>â†’</text>
      </view>
    </view>
  </view>

  <view wx:if="{{evaluation && !loading}}">
    <!-- çº¢ç»¿ç¯çŠ¶æ€ -->
    <view class="card traffic-light-card" style="background-color: {{evaluation.trafficLight.color}}15; border-color: {{evaluation.trafficLight.color}}">
      <view class="traffic-light-icon" style="color: {{evaluation.trafficLight.color}}">
        â—
      </view>
      <view class="traffic-light-info">
        <text class="traffic-light-status">{{evaluation.trafficLight.status === 'green' ? 'å®Œç¾' : evaluation.trafficLight.status === 'yellow' ? 'è‰¯å¥½' : 'éœ€æ”¹è¿›'}}</text>
        <text class="traffic-light-desc">{{evaluation.trafficLight.description}}</text>
      </view>
    </view>

    <!-- çƒ­é‡åˆ†æ -->
    <view class="card">
      <view class="card-title">çƒ­é‡åˆ†æ</view>
      <view class="calorie-item">
        <text class="label">åŸºç¡€ä»£è°¢</text>
        <text class="value">{{evaluation.tdee}} kcal</text>
      </view>
      <view class="calorie-item">
        <text class="label">é¥®é£Ÿæ‘„å…¥</text>
        <text class="value">{{evaluation.dietCalories}} kcal</text>
      </view>
      <view class="calorie-item">
        <text class="label">è¿åŠ¨æ¶ˆè€—</text>
        <text class="value">{{evaluation.exerciseCalories}} kcal</text>
      </view>
      <view class="calorie-item highlight">
        <text class="label">å®é™…çƒ­é‡å·®</text>
        <text class="value {{evaluation.actualDeficit < 0 ? 'deficit' : 'surplus'}}">{{evaluation.actualDeficit}} kcal</text>
      </view>
      <view class="calorie-item">
        <text class="label">ç›®æ ‡çƒ­é‡å·®</text>
        <text class="value">{{evaluation.targetDeficit}} kcal</text>
      </view>
    </view>

    <!-- è¥å…»è¯„åˆ† -->
    <view class="card">
      <view class="card-title">è¥å…»è¯„åˆ†</view>
      <view class="score-circle">
        <text class="score-value">{{evaluation.nutritionScore}}</text>
        <text class="score-label">åˆ†</text>
      </view>
      <progress class="progress-bar" percent="{{evaluation.nutritionScore}}" stroke-width="10" activeColor="#51CF66" backgroundColor="#f0f0f0" />
    </view>

    <!-- AIå»ºè®® -->
    <view class="card">
      <view class="card-title">AIå»ºè®®</view>
      <view class="suggestions">
        <view class="suggestion-item" wx:for="{{evaluation.suggestions}}" wx:key="index">
          <text class="suggestion-icon">ğŸ’¡</text>
          <text class="suggestion-text">{{item}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-state" wx:if="{{loading}}">
    <text class="loading-text">æ­£åœ¨ç”ŸæˆæŠ¥å‘Š...</text>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="action-buttons" wx:if="{{!loading && evaluation}}">
    <button class="action-btn secondary" bindtap="onRefresh">åˆ·æ–°è¯„ä»·</button>
    <button class="action-btn primary" bindtap="adjustPlan">è°ƒæ•´è®¡åˆ’</button>
  </view>
</view>


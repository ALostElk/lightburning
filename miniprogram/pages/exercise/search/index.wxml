<view class="page-container" style="padding-top: {{statusBarHeight + 44}}px">
  
  <view class="search-header" style="top: {{statusBarHeight}}px">
    <view class="nav-back-btn" bindtap="goBack">
      <text class="back-arrow">‹</text>
    </view>
    
    <view class="search-capsule">
      <view class="search-icon-css"></view>
      <input 
        class="search-input"
        type="text"
        placeholder="搜索运动 (如: 跑步)"
        placeholder-class="input-placeholder"
        value="{{keyword}}"
        bindinput="onSearchInput"
        bindfocus="onSearchFocus"
        confirm-type="search"
      />
      <view class="clear-btn" wx:if="{{keyword}}" bindtap="clearSearch">×</view>
    </view>
  </view>

  <scroll-view scroll-y class="search-body">
    
    <view class="results-section" wx:if="{{keyword}}">
      <view class="section-title-sm">搜索结果</view>
      
      <view class="exercise-list" wx:if="{{results.length > 0}}">
        <block wx:for="{{results}}" wx:key="id">
          <view class="exercise-card" bindtap="addExercise" data-exercise="{{item}}">
            <view class="ex-icon-box">{{item.emoji}}</view>
            <view class="ex-info">
              <text class="ex-name">{{item.name}}</text>
              <text class="ex-meta">消耗约 {{item.caloriesPerMin}} kcal/分</text>
            </view>
            <view class="add-btn-circle">
              <view class="plus-icon"></view>
            </view>
          </view>
        </block>
      </view>

      <view class="empty-state" wx:elif="{{!isSearching}}">
        <text class="empty-text">未找到相关运动</text>
      </view>
    </view>

    <view class="recommend-section" wx:else>
      
      <view class="history-group" wx:if="{{recentSearches.length > 0}}">
        <view class="group-header">
          <text class="group-title">最近搜索</text>
          <view class="clear-icon" bindtap="clearRecentSearches">清除</view>
        </view>
        <view class="tag-cloud">
          <view class="glass-tag" wx:for="{{recentSearches}}" wx:key="*this" bindtap="onRecentSearchTap" data-keyword="{{item}}">
            {{item}}
          </view>
        </view>
      </view>

      <view class="filter-scroll">
        <view 
          class="filter-chip {{selectedExerciseType === 'aerobic' ? 'active' : ''}}" 
          bindtap="switchExerciseType" data-type="aerobic"> 有氧</view>
        <view 
          class="filter-chip {{selectedExerciseType === 'strength' ? 'active' : ''}}" 
          bindtap="switchExerciseType" data-type="strength" style="position: relative; left: 32rpx; top: -1rpx"> 力量</view>
        <view 
          class="filter-chip {{selectedExerciseType === 'flexibility' ? 'active' : ''}}" 
          bindtap="switchExerciseType" data-type="flexibility" style="position: relative; left: 60rpx; top: -3rpx"> 拉伸</view>
        <view 
          class="filter-chip {{selectedExerciseType === 'sports' ? 'active' : ''}}" 
          bindtap="switchExerciseType" data-type="sports" style="position: relative; left: 97rpx; top: -3rpx"> 球类</view>
      </view>

      <view class="exercise-list animate-fade-in">
        <block wx:for="{{presetExercises}}" wx:key="id">
          <view 
            class="exercise-card" 
            wx:if="{{item.type === selectedExerciseType}}"
            bindtap="addExercise" 
            data-exercise="{{item}}"
          >
            <view class="ex-icon-box">{{item.emoji}}</view>
            <view class="ex-info">
              <text class="ex-name">{{item.name}}</text>
              <text class="ex-meta">消耗约 {{item.caloriesPerMin}} kcal/分</text>
            </view>
            <view class="add-btn-circle">
              <view class="plus-icon"></view>
            </view>
          </view>
        </block>
      </view>
      
      <view style="height: 100rpx;"></view>
    </view>

  </scroll-view>

  <view class="duration-modal {{showDurationModal ? 'show' : ''}}" catchtap="closeDurationModal">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">本次运动时长</text>
        <view class="modal-close" bindtap="closeDurationModal">×</view>
      </view>

      <view class="modal-info">
        <view class="modal-emoji">{{currentExercise.emoji}}</view>
        <view class="modal-name">{{currentExercise.name}}</view>
      </view>

      <view class="slider-box">
        <view class="slider-header">
          <text>持续时间</text>
          <text class="slider-value">{{durationInput}} <text class="unit">分钟</text></text>
        </view>
        <slider 
          class="custom-slider" 
          min="5" max="180" step="5" 
          value="{{durationInput}}" 
          activeColor="#10B981" 
          backgroundColor="#ECFDF5"
          block-size="24"
          bindchanging="onDurationChange" 
          bindchange="onDurationChange"
        />
        <view class="quick-tags">
          <view class="quick-tag" bindtap="setDuration" data-val="15">15分</view>
          <view class="quick-tag" bindtap="setDuration" data-val="30">30分</view>
          <view class="quick-tag" bindtap="setDuration" data-val="45">45分</view>
          <view class="quick-tag" bindtap="setDuration" data-val="60">60分</view>
        </view>
      </view>

      <view class="burn-preview">
        <view class="burn-label">预计消耗</view>
        <view class="burn-value">
          {{estimatedCalories}} <text class="burn-unit">kcal</text>
        </view>
      </view>

      <view class="modal-action">
        <view class="confirm-btn" bindtap="confirmAddExercise">确认记录</view>
      </view>
    </view>
  </view>

</view>

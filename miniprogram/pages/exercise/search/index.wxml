<!--è¿åŠ¨æœç´¢é¡µé¢-->
<view class="container">
  <!-- è‡ªå®šä¹‰å¯¼èˆªæ  -->
  <view class="custom-navbar">
    <view class="navbar-back" bindtap="goBack">
      <text class="back-icon">â€¹</text>
    </view>
    <view class="navbar-title">æ·»åŠ è¿åŠ¨</view>
    <view class="navbar-placeholder"></view>
  </view>

  <!-- æœç´¢æ¡† -->
  <view class="search-container">
    <view class="search-box">
      <text class="search-icon">ğŸ”</text>
      <input
        class="search-input"
        type="text"
        placeholder="æœç´¢è¿åŠ¨é¡¹ç›®"
        value="{{keyword}}"
        bindinput="onSearchInput"
        bindfocus="onSearchFocus"
        confirm-type="search"
      />
      <view class="search-clear" wx:if="{{keyword}}" bindtap="clearSearch">
        <text>Ã—</text>
      </view>
    </view>
  </view>

  <!-- æ ‡ç­¾åˆ‡æ¢ -->
  <view class="tabs-container">
    <view class="tabs">
      <view
        class="tab-item {{activeTab === 'search' ? 'active' : ''}}"
        data-tab="search"
        bindtap="switchTab"
      >
        <text>æœç´¢</text>
      </view>
      <view
        class="tab-item {{activeTab === 'favorites' ? 'active' : ''}}"
        data-tab="favorites"
        bindtap="switchTab"
      >
        <text>å¸¸ç”¨</text>
      </view>
    </view>
  </view>

  <!-- ä¸»å†…å®¹åŒº -->
  <scroll-view class="content-scroll" scroll-y>
    <!-- ============ æœç´¢æ ‡ç­¾å†…å®¹ ============ -->
    <view class="tab-content" wx:if="{{activeTab === 'search'}}">
      <!-- æœ€è¿‘æœç´¢ -->
      <view class="recent-section" wx:if="{{recentSearches.length > 0 && !keyword}}">
        <view class="section-header">
          <text class="section-title">æœ€è¿‘æœç´¢</text>
          <text class="section-action" bindtap="clearRecentSearches">æ¸…é™¤</text>
        </view>
        <view class="recent-tags">
          <view
            class="recent-tag"
            wx:for="{{recentSearches}}"
            wx:key="index"
            data-keyword="{{item}}"
            bindtap="onRecentSearchTap"
          >
            <text>{{item}}</text>
          </view>
        </view>
      </view>

      <!-- æœç´¢ç»“æœ -->
      <view class="results-section" wx:if="{{keyword}}">
        <!-- åŠ è½½ä¸­ -->
        <view class="loading-state" wx:if="{{isSearching}}">
          <view class="loading-spinner"></view>
          <text class="loading-text">æœç´¢ä¸­...</text>
        </view>

        <!-- æœç´¢ç»“æœåˆ—è¡¨ -->
        <view class="exercise-list" wx:elif="{{results.length > 0}}">
          <view
            class="exercise-card"
            wx:for="{{results}}"
            wx:key="id"
            data-exercise="{{item}}"
            bindtap="addExercise"
          >
            <view class="exercise-icon">
              <text>{{item.emoji}}</text>
            </view>
            <view class="exercise-info">
              <text class="exercise-name">{{item.name}}</text>
              <text class="exercise-meta">å»ºè®® {{item.duration}} åˆ†é’Ÿ Â· {{item.calories}} kcal</text>
            </view>
            <view class="exercise-action">
              <text class="add-icon">+</text>
            </view>
          </view>
        </view>

        <!-- æ— ç»“æœ -->
        <view class="empty-state" wx:elif="{{error}}">
          <text class="empty-icon">ğŸ”</text>
          <text class="empty-text">{{error}}</text>
        </view>
      </view>

      <!-- æ¨èè¿åŠ¨ï¼ˆæœªæœç´¢æ—¶ï¼‰ -->
      <view class="recommend-section" wx:if="{{!keyword && !isSearching}}">
        <view class="section-header">
          <text class="section-title">æ¨èè¿åŠ¨</text>
        </view>

        <!-- ç±»å‹ç­›é€‰ -->
        <view class="type-filters">
          <view
            class="type-filter {{selectedExerciseType === 'aerobic' ? 'active' : ''}}"
            data-type="aerobic"
            bindtap="switchExerciseType"
          >
            <text>ğŸƒ æœ‰æ°§</text>
          </view>
          <view
            class="type-filter {{selectedExerciseType === 'strength' ? 'active' : ''}}"
            data-type="strength"
            bindtap="switchExerciseType"
          >
            <text>ğŸ’ª åŠ›é‡</text>
          </view>
          <view
            class="type-filter {{selectedExerciseType === 'flexibility' ? 'active' : ''}}"
            data-type="flexibility"
            bindtap="switchExerciseType"
          >
            <text>ğŸ§˜ æ‹‰ä¼¸</text>
          </view>
          <view
            class="type-filter {{selectedExerciseType === 'sports' ? 'active' : ''}}"
            data-type="sports"
            bindtap="switchExerciseType"
          >
            <text>âš½ çƒç±»</text>
          </view>
        </view>

        <!-- æ¨èåˆ—è¡¨ -->
        <view class="exercise-list">
          <block wx:for="{{presetExercises}}" wx:key="id">
            <view
              class="exercise-card"
              wx:if="{{item.type === selectedExerciseType}}"
              data-exercise="{{item}}"
              bindtap="addExercise"
            >
              <view class="exercise-icon">
                <text>{{item.emoji}}</text>
              </view>
              <view class="exercise-info">
                <text class="exercise-name">{{item.name}}</text>
                <text class="exercise-meta">å»ºè®® {{item.duration}} åˆ†é’Ÿ Â· {{Math.round(item.duration * item.caloriesPerMin)}} kcal</text>
              </view>
              <view class="exercise-action">
                <text class="add-icon">+</text>
              </view>
            </view>
          </block>
        </view>
      </view>
    </view>

    <!-- ============ å¸¸ç”¨æ ‡ç­¾å†…å®¹ ============ -->
    <view class="tab-content" wx:if="{{activeTab === 'favorites'}}">
      <!-- ç±»å‹ç­›é€‰ -->
      <view class="type-filters">
        <view
          class="type-filter {{favoriteTypeFilter === 'all' ? 'active' : ''}}"
          data-type="all"
          bindtap="switchFavoriteType"
        >
          <text>å…¨éƒ¨</text>
        </view>
        <view
          class="type-filter {{favoriteTypeFilter === 'aerobic' ? 'active' : ''}}"
          data-type="aerobic"
          bindtap="switchFavoriteType"
        >
          <text>ğŸƒ æœ‰æ°§</text>
        </view>
        <view
          class="type-filter {{favoriteTypeFilter === 'strength' ? 'active' : ''}}"
          data-type="strength"
          bindtap="switchFavoriteType"
        >
          <text>ğŸ’ª åŠ›é‡</text>
        </view>
        <view
          class="type-filter {{favoriteTypeFilter === 'flexibility' ? 'active' : ''}}"
          data-type="flexibility"
          bindtap="switchFavoriteType"
        >
          <text>ğŸ§˜ æ‹‰ä¼¸</text>
        </view>
        <view
          class="type-filter {{favoriteTypeFilter === 'sports' ? 'active' : ''}}"
          data-type="sports"
          bindtap="switchFavoriteType"
        >
          <text>âš½ çƒç±»</text>
        </view>
      </view>

      <!-- å¸¸ç”¨è¿åŠ¨åˆ—è¡¨ -->
      <view class="frequent-section">
        <!-- åŠ è½½ä¸­ -->
        <view class="loading-state" wx:if="{{isLoadingFavorites}}">
          <view class="loading-spinner"></view>
          <text class="loading-text">åŠ è½½ä¸­...</text>
        </view>

        <!-- å¸¸ç”¨åˆ—è¡¨ -->
        <view class="exercise-list" wx:elif="{{frequentExercises.length > 0}}">
          <view
            class="exercise-card frequent"
            wx:for="{{frequentExercises}}"
            wx:key="name"
            data-exercise="{{item}}"
            bindtap="addFromFavorite"
          >
            <view class="exercise-icon">
              <text>{{item.emoji}}</text>
            </view>
            <view class="exercise-info">
              <text class="exercise-name">{{item.name}}</text>
              <text class="exercise-meta">å¹³å‡ {{item.duration}} åˆ†é’Ÿ Â· {{item.calories}} kcal</text>
              <text class="exercise-count">è®°å½• {{item.count}} æ¬¡</text>
            </view>
            <view class="exercise-action">
              <text class="add-icon">+</text>
            </view>
          </view>
        </view>

        <!-- ç©ºçŠ¶æ€ -->
        <view class="empty-state" wx:else>
          <text class="empty-icon">ğŸ“</text>
          <text class="empty-text">æš‚æ— å¸¸ç”¨è¿åŠ¨</text>
          <text class="empty-hint">æ·»åŠ è¿åŠ¨è®°å½•åä¼šè‡ªåŠ¨ç”Ÿæˆ</text>
        </view>
      </view>
    </view>
  </scroll-view>
</view>


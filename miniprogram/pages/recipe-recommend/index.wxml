<!--pages/recipe-recommend/index.wxml-->
<view class="container">
  
  <!-- æ ‡ç­¾åˆ‡æ¢ -->
  <view class="tabs-wrapper">
    <view class="tabs-list">
      <view class="tab-pill {{recommendType === 'goal' ? 'active' : ''}}" data-type="goal" bindtap="onTabChange">
        <text class="tab-label">ç›®æ ‡æ¨è</text>
      </view>
      <view class="tab-pill {{recommendType === 'preference' ? 'active' : ''}}" data-type="preference" bindtap="onTabChange">
        <text class="tab-label">å£å‘³åå¥½</text>
      </view>
      <view class="tab-pill {{recommendType === 'ai' ? 'active' : ''}}" data-type="ai" bindtap="onTabChange">
        <text class="tab-label">AI ç”„é€‰</text>
      </view>
    </view>
  </view>

  <!-- å†…å®¹åŒºåŸŸ -->
  <view class="content-area">
    
    <!-- AIæ™ºèƒ½å»ºè®® -->
    <view wx:if="{{recommendType === 'ai' && aiSuggestions.length > 0}}" class="ai-section">
      <view class="ai-header">
        <view class="ai-dot"></view>
        <text class="ai-title">è¥å…»å¸ˆå»ºè®®</text>
      </view>
      <view class="ai-list">
        <view 
          wx:for="{{aiSuggestions}}" 
          wx:key="type"
          class="ai-item"
        >
          <text>{{item.message}}</text>
        </view>
      </view>
    </view>

    <!-- åŠ è½½ä¸­ -->
    <view wx:if="{{loading}}" class="loading-state">
      <view class="loading-spinner"></view>
      <text class="loading-text">æ­£åœ¨ä¸ºæ‚¨å®šåˆ¶é£Ÿè°±...</text>
    </view>

    <!-- é£Ÿè°±åˆ—è¡¨ -->
    <view wx:else class="recipe-list">
      <block wx:if="{{recipes.length > 0}}">
        <view 
          wx:for="{{recipes}}" 
          wx:key="id"
          class="recipe-card"
          data-id="{{item.id}}"
          bindtap="onRecipeClick"
        >
          <!-- é¡¶éƒ¨ï¼šæ ‡é¢˜ä¸åˆ†æ•° -->
          <view class="card-header">
            <view class="header-main">
              <text class="card-title">{{item.name}}</text>
              <view class="score-badge">
                 <text class="score-val">{{item.recommendScore}}</text>
                 <text class="score-unit">åˆ†</text>
              </view>
            </view>
            
            <!-- æ”¶è—æŒ‰é’® (å³ä¸Šè§’) -->
            <view class="fav-btn" catchtap="onFavoriteClick" data-id="{{item.id}}" data-index="{{index}}">
               <text class="fav-icon {{item.isFavorited ? 'active' : ''}}">{{item.isFavorited ? 'â¤' : 'â™¡'}}</text>
            </view>
          </view>

          <!-- ä¸­éƒ¨ï¼šæ ‡ç­¾ -->
          <view class="tags-row">
            <view 
              wx:for="{{item.tags}}" 
              wx:key="*this"
              wx:for-item="tag"
              class="tag-item"
            >
              {{tag}}
            </view>
          </view>
          
          <!-- æ ¸å¿ƒæ•°æ®å±•ç¤º (Grid Layout) -->
          <view class="data-grid">
            <view class="data-item">
              <text class="data-value">{{item.calories}}</text>
              <text class="data-label">åƒå¡</text>
            </view>
            <view class="data-divider"></view>
            <view class="data-item">
              <text class="data-value">{{item.cookingTime}}</text>
              <text class="data-label">åˆ†é’Ÿ</text>
            </view>
             <block wx:if="{{item.protein}}">
              <view class="data-divider"></view>
              <view class="data-item">
                <text class="data-value">{{item.protein}}</text>
                <text class="data-label">è›‹ç™½è´¨(g)</text>
              </view>
             </block>
          </view>

          <!-- æ¨èç†ç”±/æè¿° -->
          <view wx:if="{{item.recommendReason || item.description}}" class="desc-box">
            <text class="desc-text">{{item.recommendReason || item.description}}</text>
          </view>

        </view>

        <!-- æ¢ä¸€æ‰¹æŒ‰é’® -->
        <view class="refresh-footer">
          <button class="glass-btn refresh-btn" bindtap="onRefresh">
            <text>æ¢ä¸€æ‰¹æ¨è</text>
          </button>
        </view>

      </block>
      
      <!-- ç©ºçŠ¶æ€ -->
      <view wx:else class="empty-state">
        <view class="empty-circle">
          <text class="empty-icon-text">ğŸ¥—</text>
        </view>
        <text class="empty-text">æš‚æ— ç¬¦åˆæ¡ä»¶çš„é£Ÿè°±</text>
      </view>

    </view>

  </view>
</view>

<!--pages/recipe-recommend/index.wxml-->
<view class="container">
  
  <!-- æ ‡ç­¾åˆ‡æ¢ (Floating Pills) -->
  <view class="tabs-wrapper">
    <view class="tabs-list">
      <view 
        wx:for="{{tabs}}" 
        wx:key="key"
        class="tab-pill {{recommendType === item.key ? 'active' : ''}}"
        data-type="{{item.key}}"
        bindtap="onTabChange"
      >
        <text class="tab-icon">{{item.icon}}</text>
        <text class="tab-label">{{item.label}}</text>
      </view>
    </view>
  </view>

  <!-- å†…å®¹åŒºåŸŸ -->
  <view class="content-area">
    
    <!-- AIæ™ºèƒ½å»ºè®® -->
    <view wx:if="{{recommendType === 'ai' && aiSuggestions.length > 0}}" class="glass-card ai-section">
      <view class="ai-header">
        <text class="ai-icon">ğŸ¤–</text>
        <text class="ai-title">AI è¥å…»åˆ†æ</text>
      </view>
      <view class="ai-list">
        <view 
          wx:for="{{aiSuggestions}}" 
          wx:key="type"
          class="ai-item {{item.severity}}"
        >
          <text class="ai-msg">{{item.message}}</text>
        </view>
      </view>
    </view>

    <!-- åŠ è½½ä¸­ -->
    <view wx:if="{{loading}}" class="loading-state">
      <view class="loading-spinner"></view>
      <text class="loading-text">æ­£åœ¨ä¸ºæ‚¨ç”Ÿæˆä¸ªæ€§åŒ–æ¨è...</text>
    </view>

    <!-- é£Ÿè°±åˆ—è¡¨ -->
    <view wx:else class="recipe-list">
      <view 
        wx:for="{{recipes}}" 
        wx:key="id"
        class="glass-card recipe-card"
        data-id="{{item.id}}"
        bindtap="onRecipeClick"
      >
        <!-- å›¾ç‰‡åŒº -->
        <view class="card-image-box">
          <image class="card-img" src="{{item.image}}" mode="aspectFill" />
          <view class="score-badge">
            <text class="score-star">â­</text>
            <text class="score-val">{{item.recommendScore}}</text>
          </view>
          <view class="fav-btn" catchtap="onFavoriteClick" data-id="{{item.id}}" data-index="{{index}}">
             <text class="fav-icon">{{item.isFavorited ? 'â¤ï¸' : 'ğŸ¤'}}</text>
          </view>
        </view>

        <!-- å†…å®¹åŒº -->
        <view class="card-content">
          <text class="card-title">{{item.name}}</text>
          
          <!-- æ ‡ç­¾è¡Œ (Flex Layou, fixed bug) -->
          <view class="tags-row">
            <view 
              wx:for="{{item.tags}}" 
              wx:key="*this"
              wx:for-item="tag"
              class="tag-pill"
            >
              {{tag}}
            </view>
            <view class="meta-item">â±ï¸ {{item.cookingTime}}m</view>
            <view class="meta-item">ğŸ”¥ {{item.calories}}kcal</view>
          </view>

          <text class="card-desc">{{item.description}}</text>
        </view>
      </view>

      <!-- æ¢ä¸€æ‰¹æŒ‰é’® -->
      <view class="refresh-footer">
        <button class="glass-btn refresh-btn" bindtap="onRefresh">
          <text>ğŸ”„ æ¢ä¸€æ‰¹æ¨è</text>
        </button>
      </view>
      
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:if="{{!loading && recipes.length === 0}}" class="empty-state">
      <text class="empty-icon">ğŸ½ï¸</text>
      <text class="empty-text">æš‚æ— æ¨èé£Ÿè°±</text>
    </view>

  </view>
</view>
